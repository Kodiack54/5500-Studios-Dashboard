module.exports=[803,e=>{"use strict";var t=e.i(47909),a=e.i(74017),r=e.i(96250),n=e.i(59756),o=e.i(61916),l=e.i(14444),s=e.i(10680),i=e.i(69741),d=e.i(16795),h=e.i(87718),p=e.i(95169),c=e.i(47587),u=e.i(66012),f=e.i(70101),g=e.i(26937),m=e.i(10372),v=e.i(93695);e.i(52474);var R=e.i(5232),y=e.i(89171);let w=process.env.PATCHER_URL||"http://localhost:7100",I=process.env.ENGINE_PATCHER_URL||"http://localhost:7101",E={"01":"security","02":"administrative","03":"facilities","04":"logistics","05":"electrical","06":"lowvoltage","07":"landscaping","08":"hvac","09":"plumbing",10:"janitorial",11:"support",12:"waste",13:"construction",14:"roofing",15:"painting",16:"flooring",17:"demolition",18:"environmental",19:"concrete",20:"fencing"};function S(e){if(0===e.length)return"offline";let t=e.filter(e=>"healthy"===e.health).length,a=e.filter(e=>"degraded"===e.health).length,r=e.filter(e=>"critical"===e.health||"offline"===e.health).length;return 0===t&&0===a?"critical":0===r&&0===a?"healthy":"degraded"}async function x(){let e={id:"tradelines",name:"NextBid Engine",patcherPort:7101,prodPort:"31001-31020",health:"unknown",slots:[],totalSlots:20,healthySlots:0,degradedSlots:0,offlineSlots:0,lastCheck:new Date().toISOString()};try{let t=await fetch(`${I}/server/health-all`,{method:"GET",headers:{"Content-Type":"application/json"},signal:AbortSignal.timeout(5e3)});if(t.ok){let a=await t.json();a.tradelines&&"object"==typeof a.tradelines?(e.slots=Object.entries(a.tradelines).map(([e,t])=>{let a={main:"Engine","w1-discovery":"Discovery","w2-sow":"Scope of Work","w3-docs":"Full Report","w4-proposal":"Proposal"},r=t.slotId||"00",n={Engine:parseInt(`310${r}`),Discovery:parseInt(`311${r}`),"Scope of Work":parseInt(`312${r}`),"Full Report":parseInt(`313${r}`),Proposal:parseInt(`314${r}`)},o=(t.processes||[]).map(e=>{let t=e.name?.split("-")||[],r=t.length>=3?t.slice(2).join("-"):e.name,o=a[r]||r;return{port:n[o]||e.pm2_env?.PORT||0,name:o,status:"online"===e.status?"online":"stopped"===e.status?"offline":"error",pid:e.pid,uptime:e.pm2_env?.pm_uptime,lastPing:e.pm2_env?.pm_uptime?`${Math.floor((Date.now()-e.pm2_env.pm_uptime)/1e3)}s`:void 0}}),l=["Engine","Discovery","Scope of Work","Full Report","Proposal"].map(e=>{let t=o.find(t=>t.name===e);return t||{port:n[e],name:e,status:"offline"}});return{slotId:t.slotId||"00",tradeline:e,mainPort:t.port||parseInt(`310${t.slotId||"00"}`),workers:l,health:function(e){if(0===e.length)return"offline";let t=e.filter(e=>"online"===e.status).length,a=e.length;return 0===t?"critical":t===a?"healthy":"degraded"}(l),cpu:t.cpu,memory:t.memory}}),e.slots.sort((e,t)=>e.slotId.localeCompare(t.slotId)),e.healthySlots=e.slots.filter(e=>"healthy"===e.health).length,e.degradedSlots=e.slots.filter(e=>"degraded"===e.health).length,e.offlineSlots=e.slots.filter(e=>"critical"===e.health||"offline"===e.health).length,e.health=S(e.slots)):a.health&&(e.health=a.health)}else e.health="degraded"}catch(t){console.error("Failed to fetch engine health:",t),e.health="offline",e.slots=Array.from({length:20},(e,t)=>{let a=String(t+1).padStart(2,"0");return{slotId:a,tradeline:E[a],mainPort:parseInt(`310${a}`),workers:[{port:parseInt(`310${a}`),name:"Engine",status:"offline"},{port:parseInt(`311${a}`),name:"Discovery",status:"offline"},{port:parseInt(`312${a}`),name:"Scope of Work",status:"offline"},{port:parseInt(`313${a}`),name:"Full Report",status:"offline"},{port:parseInt(`314${a}`),name:"Proposal",status:"offline"}],health:"offline"}}),e.offlineSlots=20}return e}let C={sources:[{slotId:"01",name:"us-west",port:8002},{slotId:"02",name:"us-east",port:8012},{slotId:"03",name:"us-central",port:8022}],nextbidder:[{slotId:"01",name:"supplies",port:8003},{slotId:"02",name:"stationary",port:8013},{slotId:"03",name:"construction",port:8023},{slotId:"04",name:"electronics",port:8033},{slotId:"05",name:"misc",port:8043}],portals:[{slotId:"01",name:"main",port:8004},{slotId:"02",name:"enterprise",port:8014}],nexttech:[{slotId:"01",name:"dispatch",port:8005},{slotId:"02",name:"sops",port:8015},{slotId:"03",name:"inventory",port:8025}],nexttask:[{slotId:"01",name:"quests",port:8006},{slotId:"02",name:"leaderboards",port:8016}]};async function P(e,t,a,r){let n=(C[e]||[]).map(e=>({slotId:e.slotId,tradeline:e.name,mainPort:e.port,workers:[{port:e.port,name:"Main",status:"offline"}],health:"offline"})),o={id:e,name:t,patcherPort:a,prodPort:r,health:"unknown",slots:n,totalSlots:n.length,healthySlots:0,degradedSlots:0,offlineSlots:n.length,lastCheck:new Date().toISOString()};try{let e=await fetch(`${w.replace("7100",String(a))}/status`,{method:"GET",headers:{"Content-Type":"application/json"},signal:AbortSignal.timeout(3e3)});if(e.ok){let t=await e.json();o.health=t.health||"ok"===t.status?"healthy":"degraded",t.slots&&Array.isArray(t.slots)&&(o.slots=t.slots,o.totalSlots=t.slots.length,o.healthySlots=t.slots.filter(e=>"healthy"===e.health).length,o.degradedSlots=t.slots.filter(e=>"degraded"===e.health).length,o.offlineSlots=t.slots.filter(e=>"critical"===e.health||"offline"===e.health).length,o.health=S(t.slots))}else o.health="degraded"}catch(e){console.error(`Failed to fetch ${t} health:`,e),o.health="offline"}return o}async function A(e){try{let[e,t,a,r,n,o]=await Promise.all([x(),P("sources","NextSource",7102,"8002"),P("nextbidder","NextBidder",7103,"8003"),P("portals","NextBid Portal",7104,"8004"),P("nexttech","NextTech",7105,"8005"),P("nexttask","NextTask",7106,"8006")]),l=[e,t,a,r,n,o],s={total:l.length,healthy:l.filter(e=>"healthy"===e.health).length,degraded:l.filter(e=>"degraded"===e.health).length,critical:l.filter(e=>"critical"===e.health).length,offline:l.filter(e=>"offline"===e.health).length,lastCheck:new Date().toISOString()};return y.NextResponse.json({success:!0,projects:l,summary:s})}catch(e){return console.error("Server health check failed:",e),y.NextResponse.json({success:!1,error:"Health check failed"},{status:500})}}e.s(["GET",()=>A],18672);var T=e.i(18672);let N=new t.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/servers/health/route",pathname:"/api/servers/health",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/src/app/api/servers/health/route.ts",nextConfigOutput:"",userland:T}),{workAsyncStorage:k,workUnitAsyncStorage:_,serverHooks:b}=N;function O(){return(0,r.patchFetch)({workAsyncStorage:k,workUnitAsyncStorage:_})}async function $(e,t,r){N.isDev&&(0,n.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let y="/api/servers/health/route";y=y.replace(/\/index$/,"")||"/";let w=await N.prepare(e,t,{srcPage:y,multiZoneDraftMode:!1});if(!w)return t.statusCode=400,t.end("Bad Request"),null==r.waitUntil||r.waitUntil.call(r,Promise.resolve()),null;let{buildId:I,params:E,nextConfig:S,parsedUrl:x,isDraftMode:C,prerenderManifest:P,routerServerContext:A,isOnDemandRevalidate:T,revalidateOnlyGenerated:k,resolvedPathname:_,clientReferenceManifest:b,serverActionsManifest:O}=w,$=(0,i.normalizeAppPath)(y),D=!!(P.dynamicRoutes[$]||P.routes[_]),H=async()=>((null==A?void 0:A.render404)?await A.render404(e,t,x,!1):t.end("This page could not be found"),null);if(D&&!C){let e=!!P.routes[_],t=P.dynamicRoutes[$];if(t&&!1===t.fallback&&!e){if(S.experimental.adapterPath)return await H();throw new v.NoFallbackError}}let M=null;!D||N.isDev||C||(M="/index"===(M=_)?"/":M);let U=!0===N.isDev||!D,j=D&&!U;O&&b&&(0,l.setReferenceManifestsSingleton)({page:y,clientReferenceManifest:b,serverActionsManifest:O,serverModuleMap:(0,s.createServerModuleMap)({serverActionsManifest:O})});let q=e.method||"GET",F=(0,o.getTracer)(),B=F.getActiveScopeSpan(),K={params:E,prerenderManifest:P,renderOpts:{experimental:{authInterrupts:!!S.experimental.authInterrupts},cacheComponents:!!S.cacheComponents,supportsDynamicResponse:U,incrementalCache:(0,n.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:S.cacheLife,waitUntil:r.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,a,r)=>N.onRequestError(e,t,r,A)},sharedContext:{buildId:I}},G=new d.NodeNextRequest(e),L=new d.NodeNextResponse(t),W=h.NextRequestAdapter.fromNodeNextRequest(G,(0,h.signalFromNodeResponse)(t));try{let l=async e=>N.handle(W,K).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let a=F.getRootSpanAttributes();if(!a)return;if(a.get("next.span_type")!==p.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${a.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let r=a.get("next.route");if(r){let t=`${q} ${r}`;e.setAttributes({"next.route":r,"http.route":r,"next.span_name":t}),e.updateName(t)}else e.updateName(`${q} ${y}`)}),s=!!(0,n.getRequestMeta)(e,"minimalMode"),i=async n=>{var o,i;let d=async({previousCacheEntry:a})=>{try{if(!s&&T&&k&&!a)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let o=await l(n);e.fetchMetrics=K.renderOpts.fetchMetrics;let i=K.renderOpts.pendingWaitUntil;i&&r.waitUntil&&(r.waitUntil(i),i=void 0);let d=K.renderOpts.collectedTags;if(!D)return await (0,u.sendResponse)(G,L,o,K.renderOpts.pendingWaitUntil),null;{let e=await o.blob(),t=(0,f.toNodeOutgoingHttpHeaders)(o.headers);d&&(t[m.NEXT_CACHE_TAGS_HEADER]=d),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let a=void 0!==K.renderOpts.collectedRevalidate&&!(K.renderOpts.collectedRevalidate>=m.INFINITE_CACHE)&&K.renderOpts.collectedRevalidate,r=void 0===K.renderOpts.collectedExpire||K.renderOpts.collectedExpire>=m.INFINITE_CACHE?void 0:K.renderOpts.collectedExpire;return{value:{kind:R.CachedRouteKind.APP_ROUTE,status:o.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:a,expire:r}}}}catch(t){throw(null==a?void 0:a.isStale)&&await N.onRequestError(e,t,{routerKind:"App Router",routePath:y,routeType:"route",revalidateReason:(0,c.getRevalidateReason)({isStaticGeneration:j,isOnDemandRevalidate:T})},A),t}},h=await N.handleResponse({req:e,nextConfig:S,cacheKey:M,routeKind:a.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:P,isRoutePPREnabled:!1,isOnDemandRevalidate:T,revalidateOnlyGenerated:k,responseGenerator:d,waitUntil:r.waitUntil,isMinimalMode:s});if(!D)return null;if((null==h||null==(o=h.value)?void 0:o.kind)!==R.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==h||null==(i=h.value)?void 0:i.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});s||t.setHeader("x-nextjs-cache",T?"REVALIDATED":h.isMiss?"MISS":h.isStale?"STALE":"HIT"),C&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let p=(0,f.fromNodeOutgoingHttpHeaders)(h.value.headers);return s&&D||p.delete(m.NEXT_CACHE_TAGS_HEADER),!h.cacheControl||t.getHeader("Cache-Control")||p.get("Cache-Control")||p.set("Cache-Control",(0,g.getCacheControlHeader)(h.cacheControl)),await (0,u.sendResponse)(G,L,new Response(h.value.body,{headers:p,status:h.value.status||200})),null};B?await i(B):await F.withPropagatedContext(e.headers,()=>F.trace(p.BaseServerSpan.handleRequest,{spanName:`${q} ${y}`,kind:o.SpanKind.SERVER,attributes:{"http.method":q,"http.target":e.url}},i))}catch(t){if(t instanceof v.NoFallbackError||await N.onRequestError(e,t,{routerKind:"App Router",routePath:$,routeType:"route",revalidateReason:(0,c.getRevalidateReason)({isStaticGeneration:j,isOnDemandRevalidate:T})}),D)throw t;return await (0,u.sendResponse)(G,L,new Response(null,{status:500})),null}}e.s(["handler",()=>$,"patchFetch",()=>O,"routeModule",()=>N,"serverHooks",()=>b,"workAsyncStorage",()=>k,"workUnitAsyncStorage",()=>_],803)}];

//# sourceMappingURL=node_modules_next_dist_esm_build_templates_app-route_e0b10c8b.js.map