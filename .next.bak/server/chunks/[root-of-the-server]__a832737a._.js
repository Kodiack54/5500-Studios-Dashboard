module.exports=[93695,(e,t,r)=>{t.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},70406,(e,t,r)=>{t.exports=e.x("next/dist/compiled/@opentelemetry/api",()=>require("next/dist/compiled/@opentelemetry/api"))},18622,(e,t,r)=>{t.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},56704,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},32319,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},24725,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},24250,e=>{"use strict";var t=e.i(29614);let r="https://sgfrqmkimrwmqqnafisw.supabase.co";function a(){let e=process.env.SUPABASE_SERVICE_KEY;return r&&e?(0,t.createClient)(r,e):(console.warn("Supabase service key not configured"),null)}(0,t.createClient)(r,"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNnZnJxbWtpbXJ3bXFxbmFmaXN3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQxODgxOTksImV4cCI6MjA3OTc2NDE5OX0.JwvxmZ4V4NbKljYEhPUTk0rmzDXPeFmIKIQc38hfqmQ"),e.s(["createServerClient",()=>a])},62751,e=>{"use strict";var t=e.i(75834),r=e.i(84464),a=e.i(17102),o=e.i(7794),n=e.i(49050),s=e.i(46993),i=e.i(50642),l=e.i(90975),c=e.i(32740),u=e.i(55614),d=e.i(47473),p=e.i(51757),m=e.i(18867),h=e.i(81565),g=e.i(8281),y=e.i(2785),f=e.i(93695);e.i(99283);var x=e.i(71881),v=e.i(90887),w=e.i(24250);let S=process.env.ENGINE_PATCHER_URL||"http://134.199.209.140:7101";function R(e){if(0===e)return"0 B";let t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["B","KB","MB","GB","TB"][t]}let b=["SAM.gov","Cal-e-Procure","PlanetBids","PublicPurchase","BidNet"],E={"Cal-e-Procure":"CalProcure"};async function C(e,t,r,a,o){let n=`${t}_pipeline_activity`;try{let[t,s,i,l]=await Promise.all([e.from(n).select("metrics, stage"),e.from(n).select("metrics, stage").gte("timestamp",r.toISOString()),e.from(n).select("metrics, stage").gte("timestamp",a.toISOString()),e.from(n).select("metrics, stage").gte("timestamp",o.toISOString())]),c=e=>e?e.reduce((e,t)=>{let r=t.metrics||{},a=Number(r.cost)||Number(r.ai_cost)||Number(r.openai_cost)||0;return e+a},0):0;return{week:c(s.data),month:c(i.data),year:c(l.data),allTime:c(t.data)}}catch(e){return console.error(`Error querying AI costs for ${t}:`,e),{week:0,month:0,year:0,allTime:0}}}async function _(e,t,r,a,o){let n=`${t}_discovered_opportunities`,s=`${t}_discovered_opportunity_documents`;try{let[i,l,c,u,d,p,m,h,g,y,f,x,v]=await Promise.all([e.from(n).select("*",{count:"exact",head:!0}),e.from(n).select("*",{count:"exact",head:!0}).gte("discovered_at",r.toISOString()),e.from(n).select("*",{count:"exact",head:!0}).gte("discovered_at",a.toISOString()),e.from(n).select("*",{count:"exact",head:!0}).gte("discovered_at",o.toISOString()),e.from(s).select("*",{count:"exact",head:!0}),e.from(s).select("*",{count:"exact",head:!0}).gte("uploaded_at",r.toISOString()),e.from(s).select("*",{count:"exact",head:!0}).gte("uploaded_at",a.toISOString()),e.from(s).select("*",{count:"exact",head:!0}).gte("uploaded_at",o.toISOString()),e.from(s).select("file_size"),e.from(n).select("discovery_source"),e.from(n).select("discovery_source").gte("discovered_at",r.toISOString()),e.from(n).select("discovery_source").gte("discovered_at",a.toISOString()),e.from(n).select("discovery_source").gte("discovered_at",o.toISOString())]);if(i.error?.message?.includes("does not exist")||i.error?.message?.includes("schema cache"))return null;let w=0;g.data&&Array.isArray(g.data)&&(w=g.data.reduce((e,t)=>e+(t.file_size||0),0));let S=e=>{let t={};return b.forEach(e=>t[e]=0),e&&e.forEach(e=>{let r=e.discovery_source,a=b.find(e=>{let t=E[e]||e;return r===t||r===e});a&&t[a]++}),t};return{name:t,table:s,opportunities:{week:l.count||0,month:c.count||0,year:u.count||0,allTime:i.count||0},documents:{week:p.count||0,month:m.count||0,year:h.count||0,allTime:d.count||0},bySource:{allTime:S(y.data),week:S(f.data),month:S(x.data),year:S(v.data)},storageBytes:w,storage:R(w),status:"online"}}catch(e){return console.error(`Error querying ${t}:`,e),null}}async function I(){let e=(0,w.createServerClient)();if(!e)return v.NextResponse.json({success:!1,error:"Supabase not configured"},{status:500});try{let t=new Date,r=new Date(t);r.setDate(t.getDate()-t.getDay()),r.setHours(0,0,0,0);let a=new Date(t.getFullYear(),t.getMonth(),1),o=new Date(t.getFullYear(),0,1),n=[];try{let e=await fetch(`${S}/tradelines`,{cache:"no-store"});if(e.ok){let t=await e.json();Array.isArray(t)&&(n=t.map(e=>"string"==typeof e?e:e.name).filter(e=>!!e))}}catch(e){console.warn("Could not fetch tradelines from patcher, using fallback")}0===n.length&&(n=["lowvoltage"]);let s=await Promise.all(n.map(t=>_(e,t,r,a,o))),i=await Promise.all(n.map(t=>C(e,t,r,a,o))),l={week:i.reduce((e,t)=>e+t.week,0),month:i.reduce((e,t)=>e+t.month,0),year:i.reduce((e,t)=>e+t.year,0),allTime:i.reduce((e,t)=>e+t.allTime,0)},c=s.filter(e=>null!==e),u=()=>{let e={};return b.forEach(t=>e[t]=0),e},d={opportunities:{week:0,month:0,year:0,allTime:0},documents:{week:0,month:0,year:0,allTime:0},storageBytes:0,bySource:{week:u(),month:u(),year:u(),allTime:u()}};for(let e of c)e&&(d.opportunities.week+=e.opportunities.week,d.opportunities.month+=e.opportunities.month,d.opportunities.year+=e.opportunities.year,d.opportunities.allTime+=e.opportunities.allTime,d.documents.week+=e.documents.week,d.documents.month+=e.documents.month,d.documents.year+=e.documents.year,d.documents.allTime+=e.documents.allTime,d.storageBytes+=e.storageBytes,e.bySource&&b.forEach(t=>{d.bySource.week[t]+=e.bySource.week[t]||0,d.bySource.month[t]+=e.bySource.month[t]||0,d.bySource.year[t]+=e.bySource.year[t]||0,d.bySource.allTime[t]+=e.bySource.allTime[t]||0}));let p=c.map(e=>({name:e.name,table:e.table,documents:e.documents.allTime,storage:e.storage,storageBytes:e.storageBytes,opportunities:e.opportunities.allTime,status:e.status})),m=Math.round(d.storageBytes/0x1900000000*1e3)/10;return v.NextResponse.json({success:!0,data:{opportunities:d.opportunities,documents:d.documents,bySource:d.bySource,aiCosts:l,storage:{used:{bytes:d.storageBytes,formatted:R(d.storageBytes)},limit:{bytes:0x1900000000,formatted:R(0x1900000000)},percentage:m},tradelines:p,tradelineCount:{active:c.length,total:n.length},lastUpdated:new Date().toISOString()}})}catch(e){return console.error("Analytics error:",e),v.NextResponse.json({success:!1,error:e.message},{status:500})}}e.s(["GET",()=>I],54676);var T=e.i(54676);let k=new t.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/dev-controls/analytics/engine/route",pathname:"/api/dev-controls/analytics/engine",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/Studio/kodiack-dashboard-5500/src/app/api/dev-controls/analytics/engine/route.ts",nextConfigOutput:"",userland:T}),{workAsyncStorage:O,workUnitAsyncStorage:A,serverHooks:N}=k;function P(){return(0,a.patchFetch)({workAsyncStorage:O,workUnitAsyncStorage:A})}async function q(e,t,a){k.isDev&&(0,o.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let v="/api/dev-controls/analytics/engine/route";v=v.replace(/\/index$/,"")||"/";let w=await k.prepare(e,t,{srcPage:v,multiZoneDraftMode:!1});if(!w)return t.statusCode=400,t.end("Bad Request"),null==a.waitUntil||a.waitUntil.call(a,Promise.resolve()),null;let{buildId:S,params:R,nextConfig:b,parsedUrl:E,isDraftMode:C,prerenderManifest:_,routerServerContext:I,isOnDemandRevalidate:T,revalidateOnlyGenerated:O,resolvedPathname:A,clientReferenceManifest:N,serverActionsManifest:P}=w,q=(0,l.normalizeAppPath)(v),M=!!(_.dynamicRoutes[q]||_.routes[A]),j=async()=>((null==I?void 0:I.render404)?await I.render404(e,t,E,!1):t.end("This page could not be found"),null);if(M&&!C){let e=!!_.routes[A],t=_.dynamicRoutes[q];if(t&&!1===t.fallback&&!e){if(b.experimental.adapterPath)return await j();throw new f.NoFallbackError}}let D=null;!M||k.isDev||C||(D="/index"===(D=A)?"/":D);let B=!0===k.isDev||!M,U=M&&!B;P&&N&&(0,s.setReferenceManifestsSingleton)({page:v,clientReferenceManifest:N,serverActionsManifest:P,serverModuleMap:(0,i.createServerModuleMap)({serverActionsManifest:P})});let H=e.method||"GET",F=(0,n.getTracer)(),$=F.getActiveScopeSpan(),K={params:R,prerenderManifest:_,renderOpts:{experimental:{authInterrupts:!!b.experimental.authInterrupts},cacheComponents:!!b.cacheComponents,supportsDynamicResponse:B,incrementalCache:(0,o.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:b.cacheLife,waitUntil:a.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,a)=>k.onRequestError(e,t,a,I)},sharedContext:{buildId:S}},X=new c.NodeNextRequest(e),J=new c.NodeNextResponse(t),z=u.NextRequestAdapter.fromNodeNextRequest(X,(0,u.signalFromNodeResponse)(t));try{let s=async e=>k.handle(z,K).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=F.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==d.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let a=r.get("next.route");if(a){let t=`${H} ${a}`;e.setAttributes({"next.route":a,"http.route":a,"next.span_name":t}),e.updateName(t)}else e.updateName(`${H} ${v}`)}),i=!!(0,o.getRequestMeta)(e,"minimalMode"),l=async o=>{var n,l;let c=async({previousCacheEntry:r})=>{try{if(!i&&T&&O&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let n=await s(o);e.fetchMetrics=K.renderOpts.fetchMetrics;let l=K.renderOpts.pendingWaitUntil;l&&a.waitUntil&&(a.waitUntil(l),l=void 0);let c=K.renderOpts.collectedTags;if(!M)return await (0,m.sendResponse)(X,J,n,K.renderOpts.pendingWaitUntil),null;{let e=await n.blob(),t=(0,h.toNodeOutgoingHttpHeaders)(n.headers);c&&(t[y.NEXT_CACHE_TAGS_HEADER]=c),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==K.renderOpts.collectedRevalidate&&!(K.renderOpts.collectedRevalidate>=y.INFINITE_CACHE)&&K.renderOpts.collectedRevalidate,a=void 0===K.renderOpts.collectedExpire||K.renderOpts.collectedExpire>=y.INFINITE_CACHE?void 0:K.renderOpts.collectedExpire;return{value:{kind:x.CachedRouteKind.APP_ROUTE,status:n.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:a}}}}catch(t){throw(null==r?void 0:r.isStale)&&await k.onRequestError(e,t,{routerKind:"App Router",routePath:v,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:U,isOnDemandRevalidate:T})},I),t}},u=await k.handleResponse({req:e,nextConfig:b,cacheKey:D,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:_,isRoutePPREnabled:!1,isOnDemandRevalidate:T,revalidateOnlyGenerated:O,responseGenerator:c,waitUntil:a.waitUntil,isMinimalMode:i});if(!M)return null;if((null==u||null==(n=u.value)?void 0:n.kind)!==x.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==u||null==(l=u.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});i||t.setHeader("x-nextjs-cache",T?"REVALIDATED":u.isMiss?"MISS":u.isStale?"STALE":"HIT"),C&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let d=(0,h.fromNodeOutgoingHttpHeaders)(u.value.headers);return i&&M||d.delete(y.NEXT_CACHE_TAGS_HEADER),!u.cacheControl||t.getHeader("Cache-Control")||d.get("Cache-Control")||d.set("Cache-Control",(0,g.getCacheControlHeader)(u.cacheControl)),await (0,m.sendResponse)(X,J,new Response(u.value.body,{headers:d,status:u.value.status||200})),null};$?await l($):await F.withPropagatedContext(e.headers,()=>F.trace(d.BaseServerSpan.handleRequest,{spanName:`${H} ${v}`,kind:n.SpanKind.SERVER,attributes:{"http.method":H,"http.target":e.url}},l))}catch(t){if(t instanceof f.NoFallbackError||await k.onRequestError(e,t,{routerKind:"App Router",routePath:q,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:U,isOnDemandRevalidate:T})}),M)throw t;return await (0,m.sendResponse)(X,J,new Response(null,{status:500})),null}}e.s(["handler",()=>q,"patchFetch",()=>P,"routeModule",()=>k,"serverHooks",()=>N,"workAsyncStorage",()=>O,"workUnitAsyncStorage",()=>A],62751)}];

//# sourceMappingURL=%5Broot-of-the-server%5D__a832737a._.js.map