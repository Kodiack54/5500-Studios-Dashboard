module.exports=[81304,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(69520),e=a.i(73570),f=a.i(16201),g=a.i(62722),h=a.i(5784),i=a.i(50522),j=a.i(38246);let k=[{id:"global",name:"Global Team",workspace:"global"},{id:"dev1",name:"Dev Team 1",workspace:"dev1"},{id:"dev2",name:"Dev Team 2",workspace:"dev2"},{id:"dev3",name:"Dev Team 3",workspace:"dev3"}],l=["Bugs Open","Bugs Fixed","Todos","Journal","Work Log","Ideas","Decisions","Lessons","System Breakdown","How-To Guide","Schematic","Reference","Naming Conventions","File Structure","Database Patterns","API Patterns","Component Patterns","Quirks & Gotchas","Snippets","Other"];function m(){let[a,e]=(0,c.useState)([]),[f,g]=(0,c.useState)({}),[h,i]=(0,c.useState)({}),[j,m]=(0,c.useState)([]),[t,u]=(0,c.useState)(null),[v,w]=(0,c.useState)({}),[x,y]=(0,c.useState)(!1),[z,A]=(0,c.useState)(null),[B,C]=(0,c.useState)(null),[D,E]=(0,c.useState)("healthy"),F=(0,c.useCallback)(async()=>{y(!0),C(null);try{let[a,b,c,d,f]=await Promise.all([fetch("/api/ai-sessions?limit=100",{cache:"no-store"}),fetch("/api/ai-sessions/buckets",{cache:"no-store"}),fetch("/api/ai-extractions",{cache:"no-store"}),fetch("/project-management/api/projects",{cache:"no-store"}),fetch("/project-management/api/projects/summary",{cache:"no-store"})]);if(!a.ok||!b.ok)throw Error("Failed to fetch from database");let h=await a.json(),j=await b.json(),l=c.ok?await c.json():{success:!1},n=d.ok?await d.json():{success:!1},o=f.ok?await f.json():{success:!1};if(h.success){e(h.sessions||[]);let a=(h.sessions||[]).filter(a=>"transcript"===a.source_type);if(a.length>0){let b=a[0],c=new Date(b.started_at||0),d=(new Date().getTime()-c.getTime())/6e4;E(d<=18?"healthy":"missed")}else E("missed")}if(j.success&&(g(j.buckets||{}),u(j.stats||null)),l.success&&i(l.buckets||{}),n.success&&n.projects){let a=n.projects,b=o.success&&o.summaries||{},c={};for(let d of a){let a=b[d.id]||{};c[d.id]={id:d.id,name:d.name,slug:d.slug,server_path:d.server_path,parent_id:d.parent_id||null,todos:a.pending_todos||a.todos||0,knowledge:a.pending_knowledge||a.knowledge||0,bugs:a.pending_bugs||a.bugs||0,children:[]}}let d=[];for(let b of a){let e=c[b.id];if(!e.parent_id){let f=[],g=e.todos,h=e.knowledge,i=e.bugs;for(let d of a)if(d.parent_id===b.id){let a=c[d.id];f.push(a),g+=a.todos,h+=a.knowledge,i+=a.bugs}d.push({...e,todos:g,knowledge:h,bugs:i,children:f.sort((a,b)=>a.name.localeCompare(b.name))})}}d.sort((a,b)=>a.name.localeCompare(b.name)),m(d)}let p=k.map(async a=>{try{let b=await fetch(`/api/ai-sessions/buckets?workspace=${a.workspace}`,{cache:"no-store"});if(b.ok){let c=(await b.json()).stats||{};return{id:a.id,status:{captured:Number(c.active||0)+Number(c.captured||0),flagged:Number(c.flagged||0),filed:Number(c.pending||0)+Number(c.cleaned||0)+Number(c.archived||0)}}}}catch{}return{id:a.id,status:{captured:0,flagged:0,filed:0}}}),q=await Promise.all(p),r={};q.forEach(a=>{r[a.id]=a.status}),w(r),A(new Date)}catch(a){C(a instanceof Error?a.message:"Database connection failed")}finally{y(!1)}},[]);(0,c.useEffect)(()=>{F()},[]),(0,c.useEffect)(()=>{let a=setInterval(F,5e3);return()=>clearInterval(a)},[F]);let G={active:Number(t?.active||f.active||0),processed:Number(t?.scrubbed||f.processed||f.pending_review||0),flagged:Number(t?.flagged||f.flagged||0),pending:Number(t?.pending||f.pending||0),published:Number(f.published||f.cataloged||0),cleaned:Number(t?.cleaned||f.cleaned||0),archived:Number(t?.archived||f.archived||0),total:Number(t?.total_sessions||Object.values(f).reduce((a,b)=>a+Number(b),0)),last24h:Number(t?.last_24h||0)},H=B?"down":"healthy";return(0,b.jsxs)("div",{className:"h-full flex flex-col bg-gray-900 text-white overflow-hidden",children:[(0,b.jsxs)("div",{className:"px-6 py-4 bg-gray-800 border-b border-gray-700 flex items-center justify-between shrink-0",children:[(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[(0,b.jsx)("h1",{className:"text-xl font-bold",children:"Session Logs"}),(0,b.jsx)("span",{className:"text-sm text-gray-400",children:"Database View"}),(0,b.jsx)(s,{health:H})]}),(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[z&&(0,b.jsxs)("span",{className:"text-xs text-gray-500",children:["Last updated: ",z.toLocaleTimeString()]}),(0,b.jsxs)("button",{onClick:F,disabled:x,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-700 text-white text-sm rounded-lg transition-colors",children:[(0,b.jsx)(d.RefreshCw,{className:`w-4 h-4 ${x?"animate-spin":""}`}),"Refresh"]})]})]}),B&&(0,b.jsxs)("div",{className:"px-6 py-2 bg-red-900/50 border-b border-red-700 text-red-300 text-sm",children:["Database Error: ",B]}),(0,b.jsx)("div",{className:"p-4 bg-gray-850 border-b border-gray-700 shrink-0",children:(0,b.jsx)("div",{className:"grid grid-cols-4 gap-4",children:k.map(a=>{let c=v[a.id]||{captured:0,flagged:0,filed:0};return(0,b.jsxs)("div",{className:"p-3 rounded-lg border border-gray-700 bg-gray-800/50",children:[(0,b.jsx)("div",{className:"flex items-center justify-between mb-2",children:(0,b.jsx)("span",{className:"font-medium text-white",children:a.name})}),(0,b.jsxs)("div",{className:"grid grid-cols-3 gap-2 text-center",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-lg font-bold text-blue-400",children:c.captured}),(0,b.jsx)("div",{className:"text-[10px] text-gray-500",children:"Captured"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-lg font-bold text-purple-400",children:c.flagged}),(0,b.jsx)("div",{className:"text-[10px] text-gray-500",children:"Flagged"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-lg font-bold text-green-400",children:c.filed}),(0,b.jsx)("div",{className:"text-[10px] text-gray-500",children:"Filed"})]})]})]},a.id)})})}),(0,b.jsxs)("div",{className:"flex border-b border-gray-700 shrink-0",children:[(0,b.jsxs)("div",{className:"flex-[3] px-4 py-3 bg-gray-800/50 border-r border-gray-700",children:[(0,b.jsxs)("div",{className:"flex items-center justify-around",children:[(0,b.jsx)(o,{label:"Active",value:G.active,color:"cyan"}),(0,b.jsx)(n,{}),(0,b.jsx)(o,{label:"Processed",value:G.processed,color:"blue"}),(0,b.jsx)(n,{}),(0,b.jsx)(o,{label:"Flagged",value:G.flagged,color:"purple"}),(0,b.jsx)(n,{}),(0,b.jsx)(o,{label:"Pending",value:G.pending,color:"yellow"}),(0,b.jsx)(n,{}),(0,b.jsx)(o,{label:"Published",value:G.published,color:"indigo"}),(0,b.jsx)(n,{}),(0,b.jsx)(o,{label:"Cleaned",value:G.cleaned,color:"teal"}),(0,b.jsx)(n,{}),(0,b.jsx)(o,{label:"Archived",value:G.archived,color:"green"})]}),(0,b.jsxs)("div",{className:"text-center mt-2 text-xs text-gray-500",children:[G.total," total sessions | ",G.last24h," in last 24h"]})]}),(0,b.jsx)("div",{className:"flex-1 px-3 py-2 bg-gray-800/50",children:(0,b.jsx)("div",{className:"space-y-0.5",children:["active","processed","cleaned","archived"].map(a=>(0,b.jsxs)("div",{className:"flex items-center justify-between text-xs",children:[(0,b.jsx)("span",{className:"text-gray-400 capitalize",children:a}),(0,b.jsx)("span",{className:"font-mono font-bold text-white",children:f[a]||0})]},a))})})]}),(0,b.jsxs)("div",{className:"flex-1 flex overflow-hidden",children:[(0,b.jsxs)("div",{className:"flex-1 flex flex-col border-r border-gray-700 min-w-0",children:[(0,b.jsx)("div",{className:"px-4 py-2 bg-gray-800/50 border-b border-gray-700 shrink-0",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("h2",{className:"text-sm font-medium text-gray-300",children:["Chad's Sessions (",a.length,")"]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("div",{className:`w-2.5 h-2.5 rounded-full ${"healthy"===D?"bg-green-500":"bg-red-500 animate-pulse"}`,title:"healthy"===D?"Chad: Capturing every 15 min":"Chad: MISSED 15-min capture!"}),(0,b.jsx)("span",{className:"text-xs text-gray-500",children:"Chad"})]})]})}),(0,b.jsx)("div",{className:"flex-1 overflow-auto p-3 space-y-2",children:0===a.length?(0,b.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,b.jsx)("div",{className:"text-3xl mb-2",children:"ðŸ“­"}),(0,b.jsx)("p",{children:"No sessions in database"})]}):a.map(a=>(0,b.jsx)(p,{session:a},a.id))})]}),(0,b.jsxs)("div",{className:"flex-1 flex flex-col border-r border-gray-700 min-w-0",children:[(0,b.jsx)("div",{className:"px-4 py-2 bg-gray-800/50 border-b border-gray-700 shrink-0",children:(0,b.jsx)("h2",{className:"text-sm font-medium text-gray-300",children:"Jen's Flagged Items"})}),(0,b.jsx)("div",{className:"flex-1 overflow-auto p-3",children:(0,b.jsx)("div",{className:"space-y-1",children:l.map(a=>(0,b.jsx)(q,{name:a,count:h[a]||0},a))})})]}),(0,b.jsxs)("div",{className:"flex-1 flex flex-col min-w-0",children:[(0,b.jsx)("div",{className:"px-4 py-2 bg-gray-800/50 border-b border-gray-700 shrink-0",children:(0,b.jsxs)("h2",{className:"text-sm font-medium text-gray-300",children:["Susan's Projects (",j.length,")"]})}),(0,b.jsx)("div",{className:"flex-1 overflow-auto p-3",children:(0,b.jsx)("div",{className:"space-y-2",children:0===j.length?(0,b.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,b.jsx)("div",{className:"text-3xl mb-2",children:"ðŸ“"}),(0,b.jsx)("p",{children:"No projects"})]}):j.map(a=>(0,b.jsx)(r,{project:a},a.id))})})]})]})]})}function n(){return(0,b.jsx)("span",{className:"text-gray-600 text-xs",children:"â†’"})}function o({label:a,value:c,color:d}){return(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("div",{className:`text-xl font-bold ${{cyan:"text-cyan-400",blue:"text-blue-400",indigo:"text-indigo-400",purple:"text-purple-400",yellow:"text-yellow-400",teal:"text-teal-400",green:"text-green-400"}[d]||"text-gray-400"}`,children:c}),(0,b.jsx)("div",{className:"text-[10px] text-gray-500",children:a})]})}function p({session:a}){let c=a.started_at?function(a){let b=new Date(a),c=new Date,d=new Date(c);d.setDate(d.getDate()-1);let e=b.toDateString()===c.toDateString(),f=b.toDateString()===d.toDateString(),g=b.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0});if(e)return`Today ${g}`;{if(f)return`Yesterday ${g}`;let a=b.toLocaleDateString("en-US",{month:"short",day:"numeric"});return`${a} ${g}`}}(a.started_at):"??:??",d=(()=>{if("internal_claude"===a.source_type){let b=a.terminal_port;return 5400===b?"Internal Claude (Main)":5410===b?"Internal Claude (Dev Team 1)":5420===b?"Internal Claude (Dev Team 2)":5430===b?"Internal Claude (Dev Team 3)":"Internal Claude"}return"external"===a.source_type?"External Claude":"chat_systems"===a.source_type?"Chat Systems":a.source_name&&a.source_name.trim()?a.source_name:a.user_name&&a.user_name.trim()?a.user_name:a.user_id&&!a.user_id.includes("-")?a.user_id:"Unknown"})(),e={active:"bg-cyan-900/50 text-cyan-400",processed:"bg-blue-900/50 text-blue-400",published:"bg-indigo-900/50 text-indigo-400",flagged:"bg-purple-900/50 text-purple-400",pending:"bg-yellow-900/50 text-yellow-400",cleaned:"bg-teal-900/50 text-teal-400",archived:"bg-gray-900/50 text-gray-400"};return(0,b.jsxs)("div",{className:"p-2 rounded border border-gray-700 bg-gray-800/50 text-sm",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("span",{className:"font-medium text-white truncate",children:d}),(0,b.jsx)("span",{className:"text-[10px] text-gray-500 font-mono shrink-0 ml-2",children:c})]}),(0,b.jsxs)("div",{className:"flex items-center justify-between mt-1",children:[(0,b.jsx)("span",{className:"text-xs text-gray-500 truncate",children:a.project_path||a.source_name||"Unknown"}),(0,b.jsx)("span",{className:`text-[10px] px-1.5 py-0.5 rounded ${e[a.status||"captured"]||e.captured}`,children:a.status||"captured"})]})]})}function q({name:a,count:c}){return(0,b.jsxs)("div",{className:`flex items-center justify-between py-1.5 px-2 rounded ${{active:"bg-cyan-900/20",processed:"bg-blue-900/20",published:"bg-indigo-900/20",flagged:"bg-purple-900/20",pending:"bg-yellow-900/20",cleaned:"bg-teal-900/20",archived:"bg-gray-800/30"}[a]||"bg-gray-800/30"}`,children:[(0,b.jsx)("span",{className:`text-sm truncate ${c>0?"text-white":"text-gray-500"}`,children:a}),(0,b.jsx)("span",{className:`font-mono font-bold min-w-[24px] text-right ${c>0?"text-white":"text-gray-600"}`,children:c})]})}function r({project:a}){let[d,e]=(0,c.useState)(!1),f=a.children&&a.children.length>0,g=a.todos+a.knowledge+a.bugs;return(0,b.jsxs)("div",{className:"rounded border border-gray-700 bg-gray-800/50 overflow-hidden",children:[(0,b.jsxs)("div",{className:"p-2 flex items-center gap-2 hover:bg-gray-700/50 cursor-pointer",onClick:()=>f&&e(!d),children:[f?d?(0,b.jsx)(h.ChevronDown,{className:"w-4 h-4 text-gray-500 shrink-0"}):(0,b.jsx)(i.ChevronRight,{className:"w-4 h-4 text-gray-500 shrink-0"}):(0,b.jsx)("div",{className:"w-4 shrink-0"}),(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)(j.default,{href:`/project-management?project=${a.slug}&allClients=true`,className:"font-medium text-white text-sm truncate hover:text-blue-400",onClick:a=>a.stopPropagation(),children:a.name}),g>0&&(0,b.jsx)("span",{className:"text-xs text-gray-400 ml-2 shrink-0",children:g})]}),(0,b.jsxs)("div",{className:"flex items-center gap-3 mt-1 text-xs",children:[(0,b.jsxs)("span",{className:a.todos>0?"text-blue-400":"text-gray-600",children:["To-do: ",a.todos]}),(0,b.jsxs)("span",{className:a.knowledge>0?"text-green-400":"text-gray-600",children:["Knowledge: ",a.knowledge]}),(0,b.jsxs)("span",{className:a.bugs>0?"text-red-400":"text-gray-600",children:["Bugs: ",a.bugs]}),f&&(0,b.jsxs)("span",{className:"text-gray-500",children:["(",a.children.length," projects)"]})]})]})]}),d&&f&&(0,b.jsx)("div",{className:"border-t border-gray-700 bg-gray-900/50",children:a.children.map(a=>{let c=a.todos+a.knowledge+a.bugs;return(0,b.jsxs)(j.default,{href:`/project-management?project=${a.slug}&allClients=true`,className:"block p-2 pl-8 hover:bg-gray-700/30 border-b border-gray-700/50 last:border-b-0",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("span",{className:"text-sm text-gray-300 truncate",children:a.name}),c>0&&(0,b.jsx)("span",{className:"text-xs text-gray-500 ml-2",children:c})]}),(0,b.jsxs)("div",{className:"flex items-center gap-3 mt-0.5 text-[11px]",children:[(0,b.jsx)("span",{className:a.todos>0?"text-blue-400/80":"text-gray-600",children:a.todos}),(0,b.jsx)("span",{className:a.knowledge>0?"text-green-400/80":"text-gray-600",children:a.knowledge}),(0,b.jsx)("span",{className:a.bugs>0?"text-red-400/80":"text-gray-600",children:a.bugs})]})]},a.id)})})]})}function s({health:a}){let c={healthy:{bg:"bg-green-600/20",text:"text-green-400",icon:f.CheckCircle,label:"Connected"},degraded:{bg:"bg-yellow-600/20",text:"text-yellow-400",icon:e.AlertTriangle,label:"Degraded"},down:{bg:"bg-red-600/20",text:"text-red-400",icon:g.XCircle,label:"Disconnected"}}[a],d=c.icon;return(0,b.jsxs)("div",{className:`flex items-center gap-1.5 px-2 py-1 rounded ${c.bg}`,children:[(0,b.jsx)(d,{className:`w-3.5 h-3.5 ${c.text}`}),(0,b.jsx)("span",{className:`text-xs font-medium ${c.text}`,children:c.label})]})}a.s(["default",()=>m])}];

//# sourceMappingURL=src_app_session-logs_page_tsx_da0b0cbc._.js.map