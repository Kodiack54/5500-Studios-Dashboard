{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Projects/Studio/kodiack-dashboard-5500/src/app/ai-team/api/status/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\r\n\r\n// AI Droplet where workers run\r\nconst AI_DROPLET = process.env.AI_DROPLET_URL || 'http://161.35.229.220';\r\n\r\n// AI Team worker definitions\r\nconst AI_WORKERS = [\r\n  { id: 'chad', name: 'chad-5401', port: 5401 },\r\n  { id: 'jen', name: 'jen-5402', port: 5402 },\r\n  { id: 'susan', name: 'susan-5403', port: 5403 },\r\n  { id: 'clair', name: 'clair-5404', port: 5404 },\r\n  { id: 'mike', name: 'mike-5405', port: 5405 },\r\n  { id: 'tiffany', name: 'tiffany-5406', port: 5406 },\r\n  { id: 'ryan', name: 'ryan-5407', port: 5407 },\r\n  { id: 'terminal', name: 'terminal-server-5400', port: 5400 },\r\n  { id: 'dashboard', name: 'kodiack-dashboard-5500', port: 5500 },\r\n];\r\n\r\ninterface WorkerStatus {\r\n  id: string;\r\n  status: 'online' | 'offline' | 'stuck' | 'error';\r\n  uptime?: number;\r\n  lastHeartbeat?: string;\r\n  cpu?: number;\r\n  memory?: number;\r\n  responseTime?: number;\r\n}\r\n\r\n// Check individual worker health by hitting their /health endpoint\r\nasync function checkWorkerHealth(worker: typeof AI_WORKERS[0]): Promise<WorkerStatus> {\r\n  // Dashboard is always online - we're serving this request from it!\r\n  if (worker.id === 'dashboard') {\r\n    return {\r\n      id: worker.id,\r\n      status: 'online',\r\n      lastHeartbeat: new Date().toISOString(),\r\n    };\r\n  }\r\n\r\n  const startTime = Date.now();\r\n\r\n  try {\r\n    const response = await fetch(`${AI_DROPLET}:${worker.port}/health`, {\r\n      method: 'GET',\r\n      signal: AbortSignal.timeout(3000),\r\n    });\r\n\r\n    const responseTime = Date.now() - startTime;\r\n\r\n    if (response.ok) {\r\n      const data = await response.json().catch(() => ({}));\r\n      return {\r\n        id: worker.id,\r\n        status: 'online',\r\n        responseTime,\r\n        uptime: data.uptime,\r\n        cpu: data.cpu,\r\n        memory: data.memory,\r\n        lastHeartbeat: new Date().toISOString(),\r\n      };\r\n    } else {\r\n      return {\r\n        id: worker.id,\r\n        status: 'error',\r\n        responseTime,\r\n      };\r\n    }\r\n  } catch (error) {\r\n    // Worker not responding\r\n    return {\r\n      id: worker.id,\r\n      status: 'offline',\r\n    };\r\n  }\r\n}\r\n\r\nexport async function GET(request: NextRequest) {\r\n  try {\r\n    // Check all workers in parallel\r\n    const workerStatuses = await Promise.all(\r\n      AI_WORKERS.map(worker => checkWorkerHealth(worker))\r\n    );\r\n\r\n    return NextResponse.json({\r\n      success: true,\r\n      workers: workerStatuses,\r\n      lastCheck: new Date().toISOString(),\r\n    });\r\n  } catch (error) {\r\n    console.error('AI Team status check failed:', error);\r\n    return NextResponse.json(\r\n      { success: false, error: 'Status check failed' },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;;AAEA,+BAA+B;AAC/B,MAAM,aAAa,QAAQ,GAAG,CAAC,cAAc,IAAI;AAEjD,6BAA6B;AAC7B,MAAM,aAAa;IACjB;QAAE,IAAI;QAAQ,MAAM;QAAa,MAAM;IAAK;IAC5C;QAAE,IAAI;QAAO,MAAM;QAAY,MAAM;IAAK;IAC1C;QAAE,IAAI;QAAS,MAAM;QAAc,MAAM;IAAK;IAC9C;QAAE,IAAI;QAAS,MAAM;QAAc,MAAM;IAAK;IAC9C;QAAE,IAAI;QAAQ,MAAM;QAAa,MAAM;IAAK;IAC5C;QAAE,IAAI;QAAW,MAAM;QAAgB,MAAM;IAAK;IAClD;QAAE,IAAI;QAAQ,MAAM;QAAa,MAAM;IAAK;IAC5C;QAAE,IAAI;QAAY,MAAM;QAAwB,MAAM;IAAK;IAC3D;QAAE,IAAI;QAAa,MAAM;QAA0B,MAAM;IAAK;CAC/D;AAYD,mEAAmE;AACnE,eAAe,kBAAkB,MAA4B;IAC3D,mEAAmE;IACnE,IAAI,OAAO,EAAE,KAAK,aAAa;QAC7B,OAAO;YACL,IAAI,OAAO,EAAE;YACb,QAAQ;YACR,eAAe,IAAI,OAAO,WAAW;QACvC;IACF;IAEA,MAAM,YAAY,KAAK,GAAG;IAE1B,IAAI;QACF,MAAM,WAAW,MAAM,MAAM,GAAG,WAAW,CAAC,EAAE,OAAO,IAAI,CAAC,OAAO,CAAC,EAAE;YAClE,QAAQ;YACR,QAAQ,YAAY,OAAO,CAAC;QAC9B;QAEA,MAAM,eAAe,KAAK,GAAG,KAAK;QAElC,IAAI,SAAS,EAAE,EAAE;YACf,MAAM,OAAO,MAAM,SAAS,IAAI,GAAG,KAAK,CAAC,IAAM,CAAC,CAAC,CAAC;YAClD,OAAO;gBACL,IAAI,OAAO,EAAE;gBACb,QAAQ;gBACR;gBACA,QAAQ,KAAK,MAAM;gBACnB,KAAK,KAAK,GAAG;gBACb,QAAQ,KAAK,MAAM;gBACnB,eAAe,IAAI,OAAO,WAAW;YACvC;QACF,OAAO;YACL,OAAO;gBACL,IAAI,OAAO,EAAE;gBACb,QAAQ;gBACR;YACF;QACF;IACF,EAAE,OAAO,OAAO;QACd,wBAAwB;QACxB,OAAO;YACL,IAAI,OAAO,EAAE;YACb,QAAQ;QACV;IACF;AACF;AAEO,eAAe,IAAI,OAAoB;IAC5C,IAAI;QACF,gCAAgC;QAChC,MAAM,iBAAiB,MAAM,QAAQ,GAAG,CACtC,WAAW,GAAG,CAAC,CAAA,SAAU,kBAAkB;QAG7C,OAAO,0LAAY,CAAC,IAAI,CAAC;YACvB,SAAS;YACT,SAAS;YACT,WAAW,IAAI,OAAO,WAAW;QACnC;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,gCAAgC;QAC9C,OAAO,0LAAY,CAAC,IAAI,CACtB;YAAE,SAAS;YAAO,OAAO;QAAsB,GAC/C;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}