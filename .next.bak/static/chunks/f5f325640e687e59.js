(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,62093,e=>{"use strict";var t=e.i(4828),r=e.i(65508),s=e.i(3437),a=e.i(15568),n=e.i(48700),l=e.i(49270);function i({icon:e,label:r,active:s,onClick:a}){return(0,t.jsx)("button",{onClick:a,title:r,className:`w-10 h-10 rounded-lg flex items-center justify-center text-xl transition-colors ${s?"bg-blue-600 text-white":"hover:bg-gray-700 text-gray-400"}`,children:e})}function c({items:e,activePanel:s,onPanelChange:a,storageKey:n="studio-sidebar-order"}){let[l,c]=(0,r.useState)(e),[o,d]=(0,r.useState)(null),[x,u]=(0,r.useState)(null);(0,r.useEffect)(()=>{try{let t=localStorage.getItem(n);if(t){let r=JSON.parse(t),s=r.map(t=>e.find(e=>e.id===t)).filter(e=>void 0!==e),a=e.filter(e=>!r.includes(e.id));c([...s,...a])}else c(e)}catch{c(e)}},[e,n]);let m=(0,r.useCallback)(e=>{try{localStorage.setItem(n,JSON.stringify(e.map(e=>e.id)))}catch{}},[n]),g=e=>{e.currentTarget instanceof HTMLElement&&(e.currentTarget.style.opacity="1"),d(null),u(null)},p=()=>{u(null)};return(0,t.jsx)("div",{className:"flex flex-col gap-2",children:l.map((e,r)=>(0,t.jsxs)("div",{draggable:!0,onDragStart:e=>{d(r),e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",r.toString()),e.currentTarget instanceof HTMLElement&&(e.currentTarget.style.opacity="0.5")},onDragEnd:g,onDragOver:e=>{e.preventDefault(),e.dataTransfer.dropEffect="move",u(r)},onDragLeave:p,onDrop:e=>((e,t)=>{if(e.preventDefault(),null===o||o===t)return void u(null);let r=[...l],[s]=r.splice(o,1);r.splice(t,0,s),c(r),m(r),u(null)})(e,r),className:`relative cursor-grab active:cursor-grabbing transition-transform ${x===r&&o!==r?"transform translate-y-1":""}`,children:[x===r&&null!==o&&o!==r&&(0,t.jsx)("div",{className:"absolute -top-1 left-0 right-0 h-0.5 bg-blue-500 rounded"}),(0,t.jsx)(i,{icon:e.icon,label:e.label,active:s===e.id,onClick:()=>a(s===e.id?null:e.id)})]},e.id))})}var o=e.i(67651),d=e.i(61670),x=e.i(38862);function u({url:e,setUrl:r,isLoading:s,serverStatus:a,isServerLoading:n,env:l,project:i,onNavigate:c,onRefresh:u,onStartServer:m,onStopServer:g,onRestartServer:p}){return(0,t.jsxs)("div",{className:"px-3 py-2 border-b border-gray-700 bg-gray-800 flex items-center gap-2",children:[(0,t.jsx)("div",{className:"flex items-center gap-1 pr-2 border-r border-gray-700",children:"running"===a?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("button",{onClick:g,disabled:n,className:"p-1.5 bg-red-600 hover:bg-red-700 disabled:bg-gray-600 rounded text-white",title:"Stop Server",children:(0,t.jsx)(d.Square,{className:"w-4 h-4"})}),(0,t.jsx)("button",{onClick:p,disabled:n,className:"p-1.5 bg-yellow-600 hover:bg-yellow-700 disabled:bg-gray-600 rounded text-white",title:"Restart Server",children:(0,t.jsx)(x.RefreshCw,{className:`w-4 h-4 ${n?"animate-spin":""}`})})]}):(0,t.jsxs)("button",{onClick:m,disabled:n||!i||"prod"===l.id,className:"px-3 py-1.5 bg-green-600 hover:bg-green-700 disabled:bg-gray-600 rounded text-white text-sm flex items-center gap-1",title:"prod"===l.id?"Cannot start prod server from dev studio":"Start Dev Server",children:[(0,t.jsx)(o.Play,{className:"w-4 h-4"}),n?"Starting...":"Start"]})}),(0,t.jsxs)("div",{className:`flex items-center gap-1.5 px-2 py-1 rounded border text-xs ${(()=>{switch(a){case"running":return"bg-green-600/20 text-green-400 border-green-500/50";case"starting":return"bg-yellow-600/20 text-yellow-400 border-yellow-500/50";case"error":return"bg-red-600/20 text-red-400 border-red-500/50";default:return"bg-gray-600/20 text-gray-400 border-gray-500/50"}})()}`,children:[(0,t.jsx)("span",{className:`w-2 h-2 rounded-full ${(()=>{switch(a){case"running":return"bg-green-500";case"starting":return"bg-yellow-500 animate-pulse";case"error":return"bg-red-500";default:return"bg-gray-500"}})()}`}),(0,t.jsx)("span",{className:"capitalize",children:a})]}),(0,t.jsx)("button",{onClick:u,disabled:"running"!==a,className:"p-1.5 hover:bg-gray-700 disabled:opacity-50 rounded text-gray-400 hover:text-white",title:"Refresh",children:"â†»"}),(0,t.jsxs)("div",{className:"flex-1 flex items-center bg-gray-900 rounded-lg border border-gray-700 px-3 py-1.5",children:[(0,t.jsx)("span",{className:"text-green-400 mr-2",children:"ðŸŒ"}),(0,t.jsx)("input",{type:"text",value:e,onChange:e=>r(e.target.value),onKeyDown:e=>"Enter"===e.key&&c(),placeholder:"Enter URL...",className:"flex-1 bg-transparent text-white text-sm outline-none"}),s&&(0,t.jsx)("span",{className:"animate-spin text-blue-400",children:"â—Œ"})]}),(0,t.jsx)("button",{onClick:c,className:"px-3 py-1.5 bg-blue-600 hover:bg-blue-700 text-white text-sm rounded-lg",children:"Go"}),(0,t.jsx)("div",{className:`px-2 py-1 rounded text-xs font-medium ${"dev"===l.id?"bg-blue-600/20 text-blue-400":"test"===l.id?"bg-yellow-600/20 text-yellow-400":"bg-green-600/20 text-green-400"}`,children:l.name})]})}function m({project:e,env:r,serverStatus:s,serverError:a,currentUrl:n,isServerLoading:l,iframeRef:i,onStartServer:c,onLoad:d}){return e?"stopped"===s?(0,t.jsx)("div",{className:"flex-1 bg-gray-900 flex items-center justify-center text-gray-500",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"text-4xl mb-4",children:"â¸ï¸"}),(0,t.jsx)("p",{className:"text-lg mb-2",children:"Server not running"}),(0,t.jsxs)("p",{className:"text-sm text-gray-600 mb-4",children:['Click "Start" to run ',e.name," on port ",e[r.portKey]]}),(0,t.jsxs)("button",{onClick:c,disabled:l||"prod"===r.id,className:"px-4 py-2 bg-green-600 hover:bg-green-700 disabled:bg-gray-600 rounded-lg text-white flex items-center gap-2 mx-auto",children:[(0,t.jsx)(o.Play,{className:"w-5 h-5"}),l?"Starting...":"Start Dev Server"]})]})}):"starting"===s?(0,t.jsx)("div",{className:"flex-1 bg-gray-900 flex items-center justify-center text-gray-500",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"text-4xl mb-4 animate-spin",children:"âš™ï¸"}),(0,t.jsx)("p",{className:"text-lg mb-2",children:"Starting server..."}),(0,t.jsxs)("p",{className:"text-sm text-gray-600",children:["Running npm run dev on port ",e[r.portKey]]})]})}):"error"===s?(0,t.jsx)("div",{className:"flex-1 bg-gray-900 flex items-center justify-center text-gray-500",children:(0,t.jsxs)("div",{className:"text-center max-w-md",children:[(0,t.jsx)("div",{className:"text-4xl mb-4",children:"âŒ"}),(0,t.jsx)("p",{className:"text-lg mb-2 text-red-400",children:"Server Error"}),(0,t.jsx)("p",{className:"text-sm text-gray-400 mb-4",children:a||"Unknown error occurred"}),(0,t.jsx)("button",{onClick:c,disabled:l,className:"px-4 py-2 bg-green-600 hover:bg-green-700 disabled:bg-gray-600 rounded-lg text-white",children:"Try Again"})]})}):n?(0,t.jsx)("div",{className:"flex-1 bg-white relative",children:(0,t.jsx)("iframe",{ref:i,src:n,className:"w-full h-full border-0",onLoad:d,onError:d,sandbox:"allow-same-origin allow-scripts allow-forms allow-popups",title:"Browser Preview"})}):(0,t.jsx)("div",{className:"flex-1 bg-gray-900 flex items-center justify-center text-gray-500",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"text-4xl mb-4",children:"ðŸŒ"}),(0,t.jsx)("p",{children:"Enter a URL and click Go"})]})}):(0,t.jsx)("div",{className:"flex-1 bg-gray-900 flex items-center justify-center text-gray-500",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"text-4xl mb-4",children:"ðŸŒ"}),(0,t.jsx)("p",{children:"Select a project to preview"})]})})}function g({currentUrl:e,project:r,env:s}){return(0,t.jsxs)("div",{className:"px-3 py-1 border-t border-gray-700 bg-gray-800 flex items-center justify-between text-xs text-gray-500",children:[(0,t.jsx)("span",{children:e||"No URL loaded"}),(0,t.jsx)("span",{children:r?`${r.droplet_name} \xb7 localhost:${r[s.portKey]}`:"No project selected"})]})}function p({project:e,env:s,userId:a}){let n=(0,r.useRef)(null),{url:l,setUrl:i,currentUrl:c,setCurrentUrl:o,isLoading:d,setIsLoading:x,handleNavigate:p,handleRefresh:h}=function({project:e,env:t,iframeRef:s}){let[a,n]=(0,r.useState)(""),[l,i]=(0,r.useState)(""),[c,o]=(0,r.useState)(!1);(0,r.useEffect)(()=>{if(e){let r=e[t.portKey],s=`http://localhost:${r}`;n(s),"running"===e.dev_server_status&&i(s)}},[e,t]);let d=(0,r.useCallback)(()=>{a.trim()&&(o(!0),i(a.trim().startsWith("http")?a.trim():`http://${a.trim()}`))},[a]),x=(0,r.useCallback)(()=>{s.current&&l&&(o(!0),s.current.src=l)},[l,s]);return{url:a,setUrl:n,currentUrl:l,setCurrentUrl:i,isLoading:c,setIsLoading:o,handleNavigate:d,handleRefresh:x}}({project:e,env:s,iframeRef:n}),{serverStatus:b,serverError:f,isServerLoading:y,handleStartServer:j,handleStopServer:v,handleRestartServer:N,clearError:w}=function({project:e,env:t,userId:s,setCurrentUrl:a}){let[n,l]=(0,r.useState)("stopped"),[i,c]=(0,r.useState)(null),[o,d]=(0,r.useState)(!1);(0,r.useEffect)(()=>{e&&(l(e.dev_server_status||"stopped"),c(e.dev_server_error||null))},[e]);let x=(0,r.useCallback)(async()=>{if(e?.id)try{let r=await fetch("/api/dev-server"),s=await r.json();if(s.success){let r=s.projects.find(t=>t.id===e.id);if(r&&(l(r.dev_server_status||"stopped"),c(r.dev_server_error||null),"running"===r.dev_server_status)){let r=e[t.portKey];a(`http://localhost:${r}`)}}}catch(e){console.error("Failed to fetch server status:",e)}},[e,t,a]);(0,r.useEffect)(()=>{x();let e=setInterval(x,5e3);return()=>clearInterval(e)},[x]);let u=(0,r.useCallback)(async()=>{if(e?.id){d(!0),c(null);try{let r=await fetch("/api/dev-server",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"start",project_id:e.id,user_id:s,environment:t.id})}),n=await r.json();n.success?(l("running"),setTimeout(()=>{let r=e[t.portKey];a(`http://localhost:${r}`)},1e3)):(c(n.error),l("error"))}catch(e){console.error("Failed to start server:",e),c("Failed to start server"),l("error")}finally{d(!1)}}},[e,t,s,a]),m=(0,r.useCallback)(async()=>{if(e?.id){d(!0);try{let t=await fetch("/api/dev-server",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"stop",project_id:e.id})}),r=await t.json();r.success?(l("stopped"),a("")):c(r.error)}catch(e){console.error("Failed to stop server:",e),c("Failed to stop server")}finally{d(!1)}}},[e,a]);return{serverStatus:n,serverError:i,isServerLoading:o,handleStartServer:u,handleStopServer:m,handleRestartServer:(0,r.useCallback)(async()=>{if(e?.id){d(!0);try{let t=await fetch("/api/dev-server",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"restart",project_id:e.id})}),r=await t.json();r.success||c(r.error)}catch(e){console.error("Failed to restart server:",e),c("Failed to restart server")}finally{d(!1)}}},[e]),clearError:(0,r.useCallback)(()=>{c(null)},[])}}({project:e,env:s,userId:a,setCurrentUrl:o});return(0,t.jsxs)("div",{className:"flex flex-col h-full",children:[(0,t.jsx)(u,{url:l,setUrl:i,isLoading:d,serverStatus:b,isServerLoading:y,env:s,project:e,onNavigate:p,onRefresh:h,onStartServer:j,onStopServer:v,onRestartServer:N}),f&&(0,t.jsxs)("div",{className:"px-3 py-2 bg-red-900/50 border-b border-red-700 text-red-300 text-sm flex items-center justify-between",children:[(0,t.jsxs)("span",{children:["Error: ",f]}),(0,t.jsx)("button",{onClick:w,className:"text-red-400 hover:text-red-200",children:"âœ•"})]}),(0,t.jsx)(m,{project:e,env:s,serverStatus:b,serverError:f,currentUrl:c,isServerLoading:y,iframeRef:n,onStartServer:j,onLoad:()=>x(!1)}),(0,t.jsx)(g,{currentUrl:c,project:e,env:s})]})}var h=e.i(42945);let b=(0,h.default)("power",[["path",{d:"M12 2v10",key:"mnfbl"}],["path",{d:"M18.4 6.6a9 9 0 1 1-12.77.04",key:"obofu9"}]]),f=(0,h.default)("power-off",[["path",{d:"M18.36 6.64A9 9 0 0 1 20.77 15",key:"dxknvb"}],["path",{d:"M6.16 6.16a9 9 0 1 0 12.68 12.68",key:"1x7qb5"}],["path",{d:"M12 2v4",key:"3427ic"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);var y=e.i(13890),j=e.i(58728);let v="161.35.229.220",N=`http://${v}:5403`;function w(e,t,r){if(e.readyState===WebSocket.OPEN)if(t.length>1e3){let s=[];for(let e=0;e<t.length;e+=1e3)s.push(t.slice(e,e+1e3));let a=0,n=()=>{a<s.length&&e.readyState===WebSocket.OPEN&&(e.send(JSON.stringify({type:"input",data:s[a]})),++a<s.length?setTimeout(n,50):setTimeout(()=>{e.readyState===WebSocket.OPEN&&(e.send(JSON.stringify({type:"input",data:"\r"})),r?.())},100))};n()}else e.send(JSON.stringify({type:"input",data:t})),setTimeout(()=>{e.readyState===WebSocket.OPEN&&(e.send(JSON.stringify({type:"input",data:"\r"})),r?.())},50)}function S(e,t){e.readyState===WebSocket.OPEN&&[1e3,1200,1500,2e3].forEach((r,s,a)=>{setTimeout(()=>{e.readyState===WebSocket.OPEN&&(e.send(JSON.stringify({type:"input",data:"\r"})),s===a.length-1&&t?.())},r)})}let C=function({projectPath:s="/var/www/Studio",wsUrl:a,port:l=5410,onMessage:i,sendRef:c,connectRef:o,onConversationMessage:d,onConnectionChange:x}){let{user:u}=(0,n.useUser)(),m=(0,r.useRef)(null),g=(0,r.useRef)(null),p=(0,r.useRef)(null),h=(0,r.useRef)(null),C=(0,r.useRef)(!1),[k,T]=(0,r.useState)(!1),[_,E]=(0,r.useState)(!1),[P,$]=(0,r.useState)(!1),[D,O]=(0,r.useState)(""),R=(0,r.useRef)(null),{memoryStatus:I,susanContext:A,susanContextRef:M,fetchSusanContext:L,reset:F}=function(e){let[t,s]=(0,r.useState)("idle"),[a,n]=(0,r.useState)(null),l=(0,r.useRef)(null),i=(0,r.useCallback)(async()=>{s("loading"),console.log("[useSusanBriefing] Fetching context from Susan...");try{let t=await fetch(`${N}/api/context?project=${encodeURIComponent(e)}`);if(t.ok){let e=await t.json();return console.log("[useSusanBriefing] Context received:",{hasGreeting:!!e?.greeting,greetingLength:e?.greeting?.length||0,todos:e?.todos?.length||0,ports:e?.ports?.length||0}),n(e),l.current=e,s("loaded"),e}console.log("[useSusanBriefing] Susan returned non-OK:",t.status)}catch(e){console.log("[useSusanBriefing] Susan not available:",e)}return s("error"),null},[e]),c=(0,r.useCallback)(()=>{s("idle"),n(null),l.current=null},[]);return{memoryStatus:t,susanContext:a,susanContextRef:l,fetchSusanContext:i,reset:c}}(s),W=l+1,{connectToChad:B,sendToChad:J,disconnect:U}=function(e,t,s,a=5401){let n=(0,r.useRef)(null),l=(0,r.useRef)(null),i=(0,r.useCallback)(()=>{if(!t)return void console.log("[ClaudeTerminal] No user ID available for Chad connection");try{let r=`ws://${v}:${a}/ws`;console.log("[ClaudeTerminal] Connecting to Chad at:",r);let i=new WebSocket(`${r}?project=${encodeURIComponent(e)}&userId=${t}&userName=${encodeURIComponent(s||"")}`);i.onopen=()=>{console.log("[ClaudeTerminal] Connected to Chad for transcription"),i.send(JSON.stringify({type:"session_start",payload:{}}))},i.onmessage=e=>{try{let t=JSON.parse(e.data);("session_started"===t.type||"session_created"===t.type)&&(l.current=t.sessionId,console.log("[ClaudeTerminal] Chad session started:",t.sessionId))}catch(e){console.log("[ClaudeTerminal] Chad message parse error:",e)}},i.onerror=e=>console.log("[ClaudeTerminal] Chad WebSocket error:",e),i.onclose=()=>{console.log("[ClaudeTerminal] Chad disconnected"),l.current=null},n.current=i}catch(e){console.log("[ClaudeTerminal] Could not connect to Chad:",e)}},[e,t,s,a]),c=(0,r.useCallback)(e=>{n.current?.readyState===WebSocket.OPEN&&n.current.send(JSON.stringify({type:"terminal_output",payload:{sessionId:l.current,data:e}}))},[]),o=(0,r.useCallback)(()=>{n.current?.close(),n.current=null,l.current=null},[]);return{chadWsRef:n,chadSessionIdRef:l,connectToChad:i,sendToChad:c,disconnect:o}}(s,u?.id,u?.name,W),K=(0,r.useRef)(!1),z=(0,r.useRef)(!1),q=(0,r.useCallback)(e=>{m.current?.readyState===WebSocket.OPEN&&w(m.current,e)},[]);(0,r.useEffect)(()=>{c&&(c.current=k?q:null)},[c,q,k]),(0,r.useEffect)(()=>{x?.(k)},[k,x]),(0,r.useEffect)(()=>{if(!g.current||p.current)return;(async()=>{let{Terminal:t}=await e.A(42284),{FitAddon:r}=await e.A(33576),s=new t({theme:{background:"#0d1117",foreground:"#e6edf3",cursor:"#58a6ff",cursorAccent:"#0d1117",black:"#0d1117",red:"#ff7b72",green:"#3fb950",yellow:"#d29922",blue:"#58a6ff",magenta:"#bc8cff",cyan:"#39c5cf",white:"#e6edf3",brightBlack:"#484f58",brightRed:"#ffa198",brightGreen:"#56d364",brightYellow:"#e3b341",brightBlue:"#79c0ff",brightMagenta:"#d2a8ff",brightCyan:"#56d4dd",brightWhite:"#ffffff"},fontFamily:"JetBrains Mono, Menlo, Monaco, Consolas, monospace",fontSize:13,lineHeight:1.2,cursorBlink:!0,cursorStyle:"block",scrollback:5e3,convertEol:!0}),a=new r;s.loadAddon(a),g.current&&(s.open(g.current),a.fit(),s.writeln("\x1b[36mâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\x1b[0m"),s.writeln(`\x1b[36m   ðŸ¤– AI Team Member Terminal (${l})       \x1b[0m`),s.writeln("\x1b[36mâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\x1b[0m"),s.writeln(""),s.writeln('\x1b[33mClick "Connect" to start the AI team member\x1b[0m'),s.writeln(""),p.current=s,h.current=a)})();let t=()=>{h.current&&setTimeout(()=>h.current?.fit(),100)};window.addEventListener("resize",t);let r=new ResizeObserver(t);return g.current&&r.observe(g.current),()=>{window.removeEventListener("resize",t),r.disconnect(),p.current&&(p.current.dispose(),p.current=null),h.current=null}},[l]);let H=(0,r.useCallback)(async()=>{if(m.current?.readyState===WebSocket.OPEN)return;E(!0),C.current=!1;let e=L(),t=a||`ws://${v}:${l}?path=${encodeURIComponent(s)}`;console.log("[ClaudeTerminal] Connecting via WebSocket to:",t);let r=new WebSocket(t);r.onopen=async()=>{console.log("[ClaudeTerminal] WebSocket connected"),T(!0),E(!1),B(),p.current&&(p.current.writeln("\x1b[32m[Connected]\x1b[0m"),p.current.writeln(""),p.current.writeln("\x1b[36mâ˜• Hold please... your AI team member will be right with you.\x1b[0m"),p.current.writeln("\x1b[90m   Starting Claude Code...\x1b[0m"),await e&&p.current.writeln("\x1b[35m   ðŸ“š Susan is loading memory...\x1b[0m"),p.current.writeln("")),h.current&&p.current&&r.send(JSON.stringify({type:"resize",cols:p.current.cols,rows:p.current.rows})),setTimeout(()=>{r.readyState===WebSocket.OPEN&&(r.send(JSON.stringify({type:"input",data:"claude"})),setTimeout(()=>{r.readyState===WebSocket.OPEN&&(r.send(JSON.stringify({type:"input",data:"\r"})),setTimeout(()=>{let e=M.current;if(!C.current&&r.readyState===WebSocket.OPEN)if(C.current=!0,K.current=!0,e?.greeting)console.log("[ClaudeTerminal] Sending Susan briefing to Claude"),p.current&&p.current.writeln("\x1b[35m\nðŸ“š Sending memory briefing to Claude...\x1b[0m"),w(r,e.greeting?e.greeting:"Susan couldn't load your memory. Starting fresh - what would you like to work on?",()=>{S(r,()=>{$(!0),p.current&&p.current.writeln("\x1b[32m\nâœ… Ready - chat box unlocked\x1b[0m")})});else console.log("[ClaudeTerminal] No Susan context available, sending /start command"),w(r,"/start",()=>{S(r,()=>{$(!0),p.current&&p.current.writeln("\x1b[32m\nâœ… Ready - chat box unlocked\x1b[0m")})})},25e3))},500))},2e3),setTimeout(()=>R.current?.focus(),100)},r.onmessage=e=>{try{let t=JSON.parse(e.data);if("output"===t.type&&p.current){p.current.write(t.data),p.current.scrollToBottom(),J(t.data);let e=t.data.replace(/\x1b\[[0-9;]*m/g,"").replace(/\x1b\[[0-9;]*[ABCDEFGHJKSTfnsu]/g,"").replace(/\x1b\[[0-9;]*[JK]/g,"").replace(/\x1b\[\?[0-9;]*[hl]/g,"").replace(/\x1b[()][AB0-2]/g,"").replace(/\x1b\][^\x07\x1b]*(?:\x07|\x1b\\)/g,"").replace(/\x1b\][^\x07]*\x07/g,"").replace(/\x1b[^[]\S?/g,"").replace(/\r(?!\n)/g,"").replace(/\n{3,}/g,"\n\n").trim();!z.current&&(e.includes("Claude Code")||e.includes("Opus")||e.includes("What would you like")||e.includes("How can I help")||e.includes("â¯"))&&(z.current=!0,console.log("[ClaudeTerminal] Claude Code TUI detected"))}else"exit"===t.type&&(p.current&&p.current.writeln(`\x1b[33m[Process exited: ${t.code}]\x1b[0m`),T(!1))}catch(e){console.error("[ClaudeTerminal] Message parse error:",e)}},r.onerror=e=>{console.error("[ClaudeTerminal] WebSocket error:",e),p.current&&p.current.writeln("\x1b[31m[Connection error]\x1b[0m"),E(!1)},r.onclose=()=>{console.log("[ClaudeTerminal] WebSocket closed"),T(!1),E(!1),$(!1),p.current&&p.current.writeln("\x1b[33m[Disconnected]\x1b[0m")},m.current=r},[s,a,l,L,M,B,J]),G=(0,r.useCallback)(()=>{m.current?.close(),m.current=null,U(),T(!1),$(!1),F(),K.current=!1,z.current=!1},[U,F]);(0,r.useEffect)(()=>{o&&(o.current=H)},[o,H]),(0,r.useEffect)(()=>{if(!k&&!_&&null===m.current){let e=setTimeout(()=>{H()},500);return()=>clearTimeout(e)}},[]);let V=(0,r.useCallback)(()=>{if(m.current?.readyState===WebSocket.OPEN){if(D.trim())w(m.current,D);else{var e;(e=m.current).readyState===WebSocket.OPEN&&e.send(JSON.stringify({type:"input",data:"\r"}))}O("")}},[D]);return(0,t.jsxs)("div",{className:"flex flex-col h-full bg-gray-900",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between px-3 py-2 bg-gray-800 border-b border-gray-700",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{className:"text-base",children:"ðŸ¤–"}),(0,t.jsx)("span",{className:"text-sm font-medium text-white",children:"AI Worker"}),(0,t.jsxs)("span",{className:"text-xs text-orange-400/60",children:["[:",l,"]"]}),(0,t.jsx)("span",{className:`px-1.5 py-0.5 text-xs rounded ${k?"bg-green-600/20 text-green-400":_?"bg-yellow-600/20 text-yellow-400":"bg-gray-700 text-gray-400"}`,children:k?"Connected":_?"Connecting...":"Disconnected"}),k&&(0,t.jsxs)("span",{className:`flex items-center gap-1 px-1.5 py-0.5 text-xs rounded ${"loaded"===I?"bg-purple-600/20 text-purple-400":"loading"===I?"bg-yellow-600/20 text-yellow-400":"bg-gray-700 text-gray-500"}`,children:[(0,t.jsx)(j.Brain,{className:"w-3 h-3"}),"loaded"===I?"Memory":"loading"===I?"Loading...":"No Memory"]})]}),(0,t.jsx)("div",{className:"flex items-center gap-1",children:k?(0,t.jsxs)("button",{onClick:G,className:"flex items-center gap-1 px-2 py-1 text-xs bg-red-600/20 text-red-400 hover:bg-red-600/30 rounded",children:[(0,t.jsx)(f,{className:"w-3 h-3"}),"Disconnect"]}):(0,t.jsxs)("button",{onClick:H,disabled:_,className:"flex items-center gap-1 px-2 py-1 text-xs bg-green-600/20 text-green-400 hover:bg-green-600/30 rounded disabled:opacity-50",children:[(0,t.jsx)(b,{className:"w-3 h-3"}),_?"Connecting...":"Connect"]})})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2 px-3 py-1 bg-gray-800/50 border-b border-gray-700 text-xs text-gray-500",children:[(0,t.jsx)(y.FolderOpen,{className:"w-3 h-3"}),(0,t.jsx)("span",{className:"truncate",children:s})]}),(0,t.jsx)("div",{ref:g,className:"flex-1 min-h-0 overflow-x-auto overflow-y-auto",style:{padding:"8px"}}),(0,t.jsxs)("div",{className:"shrink-0 border-t-2 border-orange-600",children:[(0,t.jsxs)("div",{className:"px-2 py-1 bg-orange-600/20 flex items-center gap-2",children:[(0,t.jsx)("span",{className:"text-orange-400 text-xs font-medium",children:"Chat with Claude"}),!k&&(0,t.jsx)("span",{className:"text-orange-400/50 text-xs",children:"(connecting...)"}),k&&!P&&(0,t.jsx)("span",{className:"text-yellow-400/70 text-xs",children:"(loading Claude & briefing...)"}),k&&P&&(0,t.jsx)("span",{className:"text-green-400/70 text-xs",children:"(ready)"})]}),(0,t.jsx)("div",{className:"px-2 py-2 bg-gray-800",children:(0,t.jsx)("textarea",{ref:R,value:D,onChange:e=>O(e.target.value),onKeyDown:e=>{"Enter"===e.key&&!e.shiftKey&&(e.preventDefault(),k&&P&&V())},placeholder:k?P?"Type a message and press Enter... (Shift+Enter for new line)":"Please wait - loading Claude and sending briefing...":"Connecting to Claude...",rows:4,disabled:!k||!P,className:"w-full bg-gray-900 border-2 border-orange-600 rounded px-3 py-2 text-sm text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-orange-500 resize-none disabled:opacity-50 disabled:cursor-not-allowed"})})]})]})};var k=e.i(47904),T=e.i(90172),_=e.i(86403);let E={isRunning:!1,queue:0,processed:0,lastActivity:null,error:null,sessionsCapured:0,lastDumpTime:null,dumpIntervalMin:10},P={isRunning:!1,queue:0,processed:0,lastActivity:null,error:null,itemsFlagged:0,currentlyProcessing:null},$={isRunning:!1,queue:0,processed:0,lastActivity:null,error:null,itemsCategorized:0,currentlyFiling:null},D={};function O({teamBasePort:e,isGlobal:s=!1}){let a=e?e+1:void 0,n=function(e){if(!e)return"Global Team";let t=Math.floor((e-5400)/10);return 0===t?"Global Team":`Development Team ${t}`}(e),{chadStatus:l,jenStatus:i,susanStatus:c,buckets:o,previousBuckets:d,sessions:u,health:m,totalPending:g,loading:p,refreshAll:h}=function(e={}){let{chadPort:t,isGlobal:s}=e,a=s||!t?null:t>=5410&&t<5420?"dev1":t>=5420&&t<5430?"dev2":t>=5430&&t<5440?"dev3":null,[n,l]=(0,r.useState)(E),[i,c]=(0,r.useState)(P),[o,d]=(0,r.useState)($),[x,u]=(0,r.useState)(D),[m,g]=(0,r.useState)(D),[p,h]=(0,r.useState)([]),[b,f]=(0,r.useState)(!1),[y,j]=(0,r.useState)({chad:"idle",jen:"idle",susan:"idle",overall:"healthy"}),v=(0,r.useRef)([]),N=Object.values(x).reduce((e,t)=>e+t,0),w=(0,r.useCallback)(async()=>{try{let e=a?`?workspace=${a}`:"",t=a?`?workspace=${a}&limit=50`:"?limit=50",[r,s]=await Promise.all([fetch(`/api/ai-sessions/buckets${e}`,{cache:"no-store"}),fetch(`/api/ai-sessions${t}`,{cache:"no-store"})]);if(!r.ok||!s.ok)throw Error("Database fetch failed");let n=await r.json(),i=await s.json();if(n.success&&n.buckets){let e=n.buckets,t=n.stats||{};g(x),u(e),v.current=[...v.current.slice(-9),e];let r=(t.captured||0)+(t.active||0),s=t.last_session,a=s&&Date.now()-new Date(s).getTime()<18e5;l({isRunning:a||!1,queue:t.active||0,processed:t.total_sessions||0,lastActivity:s,error:null,sessionsCapured:r,lastDumpTime:s,dumpIntervalMin:10});let i=t.captured||0,o=t.flagged||0;c({isRunning:i>0,queue:i,processed:o,lastActivity:s,error:null,itemsFlagged:t.flagged||0,currentlyProcessing:i>0?"Processing...":null});let m=t.flagged||0,p=(t.pending||0)+(t.cleaned||0)+(t.archived||0);d({isRunning:m>0,queue:m,processed:p,lastActivity:s,error:null,itemsCategorized:p,currentlyFiling:m>0?"Filing...":null})}i.success&&i.sessions&&h(i.sessions)}catch(t){console.error("Failed to fetch from database:",t);let e=t instanceof Error?t.message:"Database connection failed";l(t=>({...t,error:e,isRunning:!1})),c(t=>({...t,error:e,isRunning:!1})),d(t=>({...t,error:e,isRunning:!1}))}},[x,a]),S=(0,r.useCallback)(()=>{let e=Date.now(),t="idle";if(n.error)t="error";else if(n.lastActivity){let r=new Date(n.lastActivity).getTime();e-r<6e5?t="healthy":e-r>18e5&&(t="stuck")}let r="idle";i.error?r="error":i.queue>0&&(r="healthy");let s="idle";o.error?s="error":o.queue>0&&(s="healthy");let a="healthy";"error"===t||"error"===r||"error"===s?a="down":"stuck"===t&&(a="degraded"),j({chad:t,jen:r,susan:s,overall:a})},[n,i,o]),C=(0,r.useCallback)(async()=>{f(!0),await w(),S(),f(!1)},[w,S]),k=(0,r.useCallback)(async e=>{console.log(`Trigger not supported - ${e} runs on database polling schedule`),await C()},[C]),T=(0,r.useCallback)(()=>{let e=Object.values(m).reduce((e,t)=>e+t,0);return Object.values(x).reduce((e,t)=>e+t,0)-e},[x,m]);return(0,r.useEffect)(()=>{C()},[]),(0,r.useEffect)(()=>{let e=setInterval(C,5e3);return()=>clearInterval(e)},[C]),(0,r.useEffect)(()=>{S()},[n,i,o,S]),{chadStatus:n,jenStatus:i,susanStatus:o,buckets:x,previousBuckets:m,sessions:p,health:y,totalPending:N,bucketDelta:T(),loading:b,triggerTeamMember:k,refreshAll:C}}({chadPort:a,isGlobal:s});return(0,t.jsxs)("div",{className:"h-full flex flex-col bg-gray-900 text-white overflow-hidden",children:[(0,t.jsxs)("div",{className:"px-4 py-2 bg-gray-800 border-b border-gray-700 flex items-center justify-between shrink-0 relative",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("h1",{className:"text-lg font-semibold",children:"Session Hub"}),(0,t.jsx)(L,{health:m.overall})]}),(0,t.jsx)("div",{className:"absolute left-1/2 transform -translate-x-1/2",children:(0,t.jsx)("span",{className:"text-lg font-bold text-cyan-400",children:n})}),(0,t.jsxs)("button",{onClick:h,disabled:p,className:"flex items-center gap-2 px-3 py-1.5 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-700 text-white text-sm rounded transition-colors",children:[(0,t.jsx)(x.RefreshCw,{className:`w-4 h-4 ${p?"animate-spin":""}`}),"Refresh"]})]}),(0,t.jsxs)("div",{className:"flex-1 flex overflow-hidden",children:[(0,t.jsxs)("div",{className:"flex-1 flex flex-col border-r border-gray-700 min-w-0",children:[(0,t.jsx)(R,{name:"Chad",role:"Capture",health:m.chad,metric:l.sessionsCapured,metricLabel:"captured",color:"blue",error:l.error}),(0,t.jsx)("div",{className:"flex-1 overflow-auto p-3 space-y-2",children:0===u.length?(0,t.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,t.jsx)("div",{className:"text-2xl mb-2",children:"ðŸ“­"}),(0,t.jsx)("p",{className:"text-sm",children:"No sessions yet"}),(0,t.jsx)("p",{className:"text-xs mt-1",children:"Dumps every 10 min"})]}):u.map(e=>(0,t.jsx)(I,{session:e},e.id))})]}),(0,t.jsxs)("div",{className:"flex-1 flex flex-col border-r border-gray-700 min-w-0",children:[(0,t.jsx)(R,{name:"Jen",role:"Scrub & Flag",health:m.jen,metric:i.itemsFlagged,metricLabel:"flagged",color:"purple",error:i.error}),(0,t.jsx)("div",{className:"flex-1 overflow-auto p-3",children:0===Object.keys(o).length?(0,t.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,t.jsx)("div",{className:"text-2xl mb-2",children:"ðŸ·ï¸"}),(0,t.jsx)("p",{className:"text-sm",children:"No items flagged yet"})]}):(0,t.jsxs)("div",{className:"space-y-1",children:[Object.entries(o).sort((e,t)=>t[1]-e[1]).map(([e,r])=>(0,t.jsx)(A,{name:e,count:r,prev:d[e]??0},e)),(0,t.jsx)("div",{className:"pt-2 mt-2 border-t border-gray-700",children:(0,t.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,t.jsx)("span",{className:"text-gray-400",children:"Total Pending"}),(0,t.jsx)("span",{className:"font-bold text-yellow-400",children:g})]})})]})})]}),(0,t.jsxs)("div",{className:"flex-1 flex flex-col min-w-0",children:[(0,t.jsx)(R,{name:"Susan",role:"Categorize & File",health:m.susan,metric:c.itemsCategorized,metricLabel:"filed",color:"green",error:c.error}),(0,t.jsx)("div",{className:"flex-1 overflow-auto p-3",children:0===c.itemsCategorized?(0,t.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,t.jsx)("div",{className:"text-2xl mb-2",children:"ðŸ“"}),(0,t.jsx)("p",{className:"text-sm",children:"No items filed yet"}),(0,t.jsx)("p",{className:"text-xs mt-1",children:"Waiting for Jen"})]}):(0,t.jsx)("div",{className:"space-y-2",children:(0,t.jsx)(M,{sessions:u})})})]})]})]})}function R({name:e,role:r,health:s,metric:a,metricLabel:n,color:l,error:i}){return(0,t.jsxs)("div",{className:`p-3 border-b ${{blue:"bg-blue-900/50 border-blue-600",purple:"bg-purple-900/50 border-purple-600",green:"bg-green-900/50 border-green-600"}[l]} shrink-0`,children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{className:`w-2 h-2 rounded-full ${{healthy:"bg-green-400",stuck:"bg-yellow-400 animate-pulse",error:"bg-red-400",idle:"bg-gray-500"}[s]}`}),(0,t.jsx)("span",{className:`font-semibold ${{blue:"text-blue-400",purple:"text-purple-400",green:"text-green-400"}[l]}`,children:e})]}),(0,t.jsx)("span",{className:"text-xs text-gray-500",children:r})]}),(0,t.jsxs)("div",{className:"flex items-baseline gap-1",children:[(0,t.jsx)("span",{className:"text-2xl font-bold text-white",children:a}),(0,t.jsx)("span",{className:"text-xs text-gray-500",children:n})]}),i&&(0,t.jsx)("div",{className:"mt-1 text-[10px] text-red-400 truncate",children:i})]})}function I({session:e}){let r=e.started_at?F(e.started_at):"??:??",s=e.ended_at?F(e.ended_at):"now",a=e.user_name||e.user_id||"Unknown",n=e.source_name||e.source_type||"Terminal",l=e.categorized_by_susan,i=e.scrubbed_by_jen&&!l,c=e.captured_by_chad&&!e.scrubbed_by_jen;return(0,t.jsxs)("div",{className:`p-2 rounded border text-sm ${l?"border-green-800/50 bg-green-900/10 opacity-50":i?"border-purple-800/50 bg-purple-900/20":c?"border-yellow-800/50 bg-yellow-900/20":"border-blue-800/50 bg-blue-900/20"}`,children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("span",{className:"font-medium text-white truncate",children:a}),(0,t.jsxs)("span",{className:"text-[10px] text-gray-500 font-mono shrink-0 ml-2",children:[r," - ",s]})]}),(0,t.jsxs)("div",{className:"flex items-center justify-between mt-1",children:[(0,t.jsx)("span",{className:"text-xs text-gray-500 truncate",children:n}),(0,t.jsx)("span",{className:`text-[10px] px-1.5 py-0.5 rounded ${l?"bg-green-900/50 text-green-400":i?"bg-purple-900/50 text-purple-400":c?"bg-yellow-900/50 text-yellow-400":"bg-blue-900/50 text-blue-400"}`,children:l?"âœ“ Done":i?"â†’ Jen":c?"â†’ Susan":"Captured"})]})]})}function A({name:e,count:r,prev:s}){let a=r-s;return(0,t.jsxs)("div",{className:`flex items-center justify-between py-1.5 px-2 rounded ${r>0?"bg-purple-900/20":"bg-gray-800/30"}`,children:[(0,t.jsx)("span",{className:`text-sm truncate ${r>0?"text-white":"text-gray-500"}`,children:e}),(0,t.jsxs)("div",{className:"flex items-center gap-2 shrink-0 ml-2",children:[0!==a&&(0,t.jsxs)("span",{className:`text-[10px] font-mono ${a>0?"text-green-400":"text-red-400"}`,children:[a>0?"+":"",a]}),(0,t.jsx)("span",{className:`font-mono font-bold min-w-[24px] text-right ${r>0?"text-purple-400":"text-gray-600"}`,children:r})]})]})}function M({sessions:e}){let r={};e.filter(e=>e.categorized_by_susan).forEach(e=>{let t=e.project_path||e.source_name||"Unknown Project",s=t.split("/").pop()||t;r[s]||(r[s]={count:0,recent:[]}),r[s].count++,r[s].recent.length<3&&r[s].recent.push(e.user_name||e.user_id||"Unknown")});let s=Object.entries(r).sort((e,t)=>t[1].count-e[1].count);return 0===s.length?(0,t.jsx)("div",{className:"text-center py-4 text-gray-500 text-sm",children:"No items filed to projects yet"}):(0,t.jsx)("div",{className:"space-y-2",children:s.map(([e,r])=>(0,t.jsxs)("div",{className:"p-2 rounded bg-green-900/20 border border-green-800/50",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("span",{className:"text-sm font-medium text-white truncate",children:e}),(0,t.jsx)("span",{className:"text-green-400 font-mono font-bold",children:r.count})]}),(0,t.jsx)("div",{className:"text-[10px] text-gray-500 mt-1 truncate",children:r.recent.join(", ")})]},e))})}function L({health:e}){let r={healthy:{bg:"bg-green-600/20",text:"text-green-400",icon:T.CheckCircle,label:"Healthy"},degraded:{bg:"bg-yellow-600/20",text:"text-yellow-400",icon:k.AlertTriangle,label:"Degraded"},down:{bg:"bg-red-600/20",text:"text-red-400",icon:_.XCircle,label:"Down"}}[e],s=r.icon;return(0,t.jsxs)("div",{className:`flex items-center gap-1.5 px-2 py-1 rounded ${r.bg}`,children:[(0,t.jsx)(s,{className:`w-3.5 h-3.5 ${r.text}`}),(0,t.jsx)("span",{className:`text-xs font-medium ${r.text}`,children:r.label})]})}function F(e){return new Date(e).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})}var W=e.i(13401),B=e.i(68694),J=e.i(35822),U=e.i(76352),K=e.i(56424),z=e.i(64501),q=e.i(71440),H=e.i(93869),G=e.i(3046),V=e.i(86116),Y=e.i(57987),X=e.i(11565),Z=e.i(10857),Q=e.i(27845),ee=e.i(82347),et=e.i(91022),er=e.i(65926),es=e.i(25978),ea=e.i(27805),en=e.i(70287),el=e.i(17691),ei=e.i(97557),ec=e.i(15403),eo=e.i(1739),ed=e.i(63717);function ex({project:e,summary:r,formatTimeAgo:s,onSelect:a,onEdit:n}){let{attributes:l,listeners:i,setNodeRef:c,transform:o,transition:d,isDragging:x}=(0,et.useSortable)({id:e.id}),u={transform:er.CSS.Transform.toString(o),transition:d,opacity:x?.5:1,zIndex:x?1e3:"auto"};return(0,t.jsx)("div",{ref:c,style:u,className:"p-3 bg-gray-800 hover:bg-gray-750 border border-gray-700 hover:border-blue-500 rounded cursor-pointer group transition-colors",children:(0,t.jsxs)("div",{className:"flex items-start gap-3",children:[(0,t.jsx)("button",{...l,...i,className:"p-1 text-gray-600 hover:text-white cursor-grab active:cursor-grabbing flex-shrink-0 mt-1",onClick:e=>e.stopPropagation(),children:(0,t.jsx)(z.GripVertical,{className:"w-4 h-4"})}),(0,t.jsx)("div",{onClick:()=>a(e),className:"flex-shrink-0",children:e.logo_url?(0,t.jsx)("img",{src:e.logo_url,alt:"",className:"w-10 h-10 rounded object-cover"}):(0,t.jsx)("div",{className:"w-10 h-10 rounded bg-blue-600/20 flex items-center justify-center text-blue-400 font-bold",children:e.name.charAt(0).toUpperCase()})}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",onClick:()=>a(e),children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{className:"text-white font-medium",children:e.name}),(0,t.jsxs)("span",{className:"text-gray-600 text-xs",children:["(",e.slug,")"]}),(0,t.jsx)(U.ChevronRight,{className:"w-4 h-4 text-gray-600 group-hover:text-blue-400 ml-auto flex-shrink-0"})]}),e.description&&(0,t.jsx)("p",{className:"text-gray-400 text-sm mt-0.5 truncate",children:e.description}),(0,t.jsxs)("div",{className:"flex flex-wrap items-center gap-x-4 gap-y-1 mt-2 text-xs",children:[e.droplet_name&&(0,t.jsxs)("span",{className:"flex items-center gap-1 text-gray-400",children:[(0,t.jsx)(J.Server,{className:"w-3 h-3"}),e.droplet_name,e.droplet_ip&&(0,t.jsxs)("span",{className:"text-gray-600",children:["(",e.droplet_ip,")"]})]}),(e.port_dev||e.port_test||e.port_prod)&&(0,t.jsxs)("span",{className:"flex items-center gap-1",children:[e.port_dev&&(0,t.jsxs)("span",{className:"px-1.5 py-0.5 bg-blue-600/20 text-blue-400 rounded",children:["Dev:",e.port_dev]}),e.port_test&&(0,t.jsxs)("span",{className:"px-1.5 py-0.5 bg-yellow-600/20 text-yellow-400 rounded",children:["Test:",e.port_test]}),e.port_prod&&(0,t.jsxs)("span",{className:"px-1.5 py-0.5 bg-green-600/20 text-green-400 rounded",children:["Prod:",e.port_prod]})]}),e.build_number&&(0,t.jsxs)("span",{className:"text-gray-500",children:["Build: ",(0,t.jsx)("span",{className:"text-gray-300",children:e.build_number})]}),e.git_repo&&(0,t.jsx)("span",{className:"text-gray-500 truncate max-w-[200px]",children:e.git_repo.replace("https://github.com/","")})]}),r&&(0,t.jsxs)("div",{className:"flex flex-wrap items-center gap-x-3 gap-y-1 mt-2 pt-2 border-t border-gray-700/50 text-xs",children:[r.todos.total>0&&(0,t.jsxs)("span",{className:"flex items-center gap-1 text-gray-400",children:[(0,t.jsx)(q.CheckSquare,{className:"w-3 h-3"}),(0,t.jsx)("span",{className:"text-yellow-400",children:r.todos.pending}),(0,t.jsx)("span",{className:"text-gray-600",children:"/"}),(0,t.jsx)("span",{className:"text-green-400",children:r.todos.completed}),(0,t.jsx)("span",{className:"text-gray-600",children:"todos"})]}),r.knowledge>0&&(0,t.jsxs)("span",{className:"flex items-center gap-1 text-gray-400",children:[(0,t.jsx)(H.BookOpen,{className:"w-3 h-3"}),(0,t.jsx)("span",{className:"text-purple-400",children:r.knowledge}),(0,t.jsx)("span",{className:"text-gray-600",children:"knowledge"})]}),r.bugs>0&&(0,t.jsxs)("span",{className:"flex items-center gap-1 text-gray-400",children:[(0,t.jsx)(V.AlertCircle,{className:"w-3 h-3"}),(0,t.jsx)("span",{className:"text-red-400",children:r.bugs}),(0,t.jsx)("span",{className:"text-gray-600",children:"bugs"})]}),r.sessions.pending>0&&(0,t.jsxs)("span",{className:"flex items-center gap-1 px-1.5 py-0.5 bg-yellow-600/10 text-yellow-400 rounded",children:[r.sessions.pending," pending"]}),r.last_activity&&(0,t.jsxs)("span",{className:"flex items-center gap-1 text-gray-500 ml-auto",children:[(0,t.jsx)(G.Clock,{className:"w-3 h-3"}),s(r.last_activity)]})]})]}),(0,t.jsx)("button",{onClick:t=>{t.stopPropagation(),n(e)},className:"p-2 text-gray-500 hover:text-white hover:bg-gray-700 rounded opacity-0 group-hover:opacity-100 transition-all flex-shrink-0",children:(0,t.jsx)(K.Settings,{className:"w-4 h-4"})})]})})}function eu({onProjectsChange:e}){let{selectedClient:s}=(0,X.useClient)(),[a,n]=(0,r.useState)([]),[l,i]=(0,r.useState)(null),[c,o]=(0,r.useState)("todos"),[d,x]=(0,r.useState)(!0),[u,m]=(0,r.useState)(!1),[g,p]=(0,r.useState)(null),[h,b]=(0,r.useState)({}),f=(0,ee.useSensors)((0,ee.useSensor)(ee.PointerSensor,{activationConstraint:{distance:8}}),(0,ee.useSensor)(ee.KeyboardSensor,{coordinateGetter:et.sortableKeyboardCoordinates})),y=s?a.filter(e=>e.client_id===s.id):a;(0,r.useEffect)(()=>{j()},[]),(0,r.useEffect)(()=>{y.length>0&&v()},[y]);let j=async()=>{try{let e=await fetch("/project-management/api/projects"),t=await e.json();t.success&&n(t.projects)}catch(e){console.error("Error fetching projects:",e)}finally{x(!1)}},v=async()=>{try{let e=await fetch("/project-management/api/projects/summary"),t=await e.json();t.success&&t.summaries&&b(t.summaries)}catch(e){console.error("Error fetching project summaries:",e)}},N=e=>{if(!e)return null;let t=new Date(e),r=Math.floor((new Date().getTime()-t.getTime())/6e4),s=Math.floor(r/60),a=Math.floor(s/24);return r<1?"just now":r<60?`${r}m ago`:s<24?`${s}h ago`:a<7?`${a}d ago`:t.toLocaleDateString()},w=e=>{i(e),o("todos")},S=e=>{p(e),m(!0)},C=()=>{m(!1),p(null)},k=()=>{j(),e?.(),C()},T=async t=>{let{active:r,over:s}=t;if(!s||r.id===s.id)return;let l=y.findIndex(e=>e.id===r.id),i=y.findIndex(e=>e.id===s.id);if(-1===l||-1===i)return;let c=(0,et.arrayMove)(y,l,i),o=[...a];c.forEach((e,t)=>{let r=o.findIndex(t=>t.id===e.id);-1!==r&&(o[r]={...o[r],sort_order:t})}),n(o);try{await Promise.all(c.map((e,t)=>fetch("/project-management/api/projects",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e.id,sort_order:t})}))),e?.()}catch(e){console.error("Error saving project order:",e),j()}};return d?(0,t.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,t.jsx)("div",{className:"animate-spin text-2xl",children:"âš™ï¸"})}):l?(0,t.jsxs)("div",{className:"flex flex-col h-full",children:[(0,t.jsxs)("button",{onClick:()=>{i(null)},className:"flex items-center gap-2 text-gray-400 hover:text-white mb-3 text-sm",children:[(0,t.jsx)(B.ArrowLeft,{className:"w-4 h-4"}),"All Projects"]}),(0,t.jsx)("div",{className:"mb-3 pb-3 border-b border-gray-700",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-lg font-semibold text-white",children:l.name}),l.description&&(0,t.jsx)("p",{className:"text-gray-400 text-sm",children:l.description}),(0,t.jsxs)("div",{className:"flex items-center gap-3 mt-2 text-xs text-gray-500",children:[l.droplet_name&&(0,t.jsxs)("span",{className:"flex items-center gap-1",children:[(0,t.jsx)(J.Server,{className:"w-3 h-3"}),l.droplet_name]}),l.port_dev&&(0,t.jsxs)("span",{className:"px-2 py-0.5 bg-blue-600/20 text-blue-400 rounded",children:["Dev: ",l.port_dev]})]})]}),(0,t.jsx)("button",{onClick:()=>S(l),className:"p-2 text-gray-400 hover:text-white hover:bg-gray-700 rounded",children:(0,t.jsx)(K.Settings,{className:"w-4 h-4"})})]})}),(0,t.jsx)(Z.default,{activeTab:c,onTabChange:o}),(0,t.jsx)("div",{className:"flex-1 overflow-auto mt-3",children:(()=>{if(!l)return null;let e=l.server_path||"";switch(c){case"todos":return(0,t.jsx)(es.default,{projectPath:e,projectId:l.id});case"knowledge":return(0,t.jsx)(ed.default,{projectPath:e,projectId:l.id});case"docs":return(0,t.jsx)(ea.default,{projectPath:e,projectId:l.id});case"database":return(0,t.jsx)(en.default,{projectPath:e,projectId:l.id});case"structure":return(0,t.jsx)(el.default,{projectPath:e,projectId:l.id});case"conventions":return(0,t.jsx)(eo.default,{projectPath:e,projectId:l.id});case"notepad":return(0,t.jsx)(ei.default,{projectPath:e,projectId:l.id});case"bugs":return(0,t.jsx)(ec.default,{projectPath:e,projectId:l.id});default:return null}})()}),u&&(0,t.jsx)(Q.default,{project:g,onClose:C,onSave:k})]}):(0,t.jsxs)("div",{className:"flex flex-col h-full",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsxs)("span",{className:"text-gray-400 text-sm",children:[y.length," projects"]}),s&&(0,t.jsxs)("span",{className:"px-2 py-0.5 bg-blue-600/20 text-blue-400 rounded text-xs flex items-center gap-1",children:[(0,t.jsx)(Y.Building2,{className:"w-3 h-3"}),s.name]})]}),(0,t.jsxs)("button",{onClick:()=>{p(null),m(!0)},className:"flex items-center gap-1 px-2 py-1 bg-blue-600 hover:bg-blue-700 text-white rounded text-sm",children:[(0,t.jsx)(W.Plus,{className:"w-3 h-3"}),"Add"]})]}),0===y.length?(0,t.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,t.jsx)("div",{className:"text-4xl mb-2",children:"ðŸ“"}),(0,t.jsx)("p",{children:"No projects yet"})]}):(0,t.jsx)(ee.DndContext,{sensors:f,collisionDetection:ee.closestCenter,onDragEnd:T,children:(0,t.jsx)(et.SortableContext,{items:y.map(e=>e.id),strategy:et.verticalListSortingStrategy,children:(0,t.jsx)("div",{className:"flex-1 overflow-auto space-y-2",children:y.map(e=>(0,t.jsx)(ex,{project:e,summary:h[e.id],formatTimeAgo:N,onSelect:w,onEdit:S},e.id))})})}),u&&(0,t.jsx)(Q.default,{project:g,onClose:C,onSave:k})]})}let em=(0,h.default)("plug",[["path",{d:"M12 22v-5",key:"1ega77"}],["path",{d:"M15 8V2",key:"18g5xt"}],["path",{d:"M17 8a1 1 0 0 1 1 1v4a4 4 0 0 1-4 4h-4a4 4 0 0 1-4-4V9a1 1 0 0 1 1-1z",key:"1xoxul"}],["path",{d:"M9 8V2",key:"14iosj"}]]),eg=(0,h.default)("plug-zap",[["path",{d:"M6.3 20.3a2.4 2.4 0 0 0 3.4 0L12 18l-6-6-2.3 2.3a2.4 2.4 0 0 0 0 3.4Z",key:"goz73y"}],["path",{d:"m2 22 3-3",key:"19mgm9"}],["path",{d:"M7.5 13.5 10 11",key:"7xgeeb"}],["path",{d:"M10.5 16.5 13 14",key:"10btkg"}],["path",{d:"m18 3-4 4h6l-4 4",key:"16psg9"}]]),ep=(0,h.default)("monitor",[["rect",{width:"20",height:"14",x:"2",y:"3",rx:"2",key:"48i651"}],["line",{x1:"8",x2:"16",y1:"21",y2:"21",key:"1svkeh"}],["line",{x1:"12",x2:"12",y1:"17",y2:"21",key:"vw1qmm"}]]),eh=[{id:"dev",name:"Dev Studio",portKey:"port_dev"},{id:"test",name:"Test",portKey:"port_test"},{id:"prod",name:"Production",portKey:"port_prod",readOnly:!0}],eb=[{id:"files",icon:"ðŸ“",label:"Files"},{id:"terminal",icon:"ðŸ’»",label:"Terminal"},{id:"ai-usage",icon:"ðŸ’°",label:"AI Usage"},{id:"browser",icon:"ðŸŒ",label:"Browser"},{id:"schema",icon:"ðŸ—„ï¸",label:"DB Schema"},{id:"chatlog",icon:"ðŸ“œ",label:"Chat Log"},{id:"hub",icon:"ðŸŽ¯",label:"Session Hub"},{id:"storage",icon:"ðŸ’¾",label:"Storage"},{id:"projects",icon:"âš™ï¸",label:"Projects"},{id:"docs",icon:"ðŸ“",label:"Docs"},{id:"health",icon:"ðŸ©º",label:"AI Health"}];function ef(){let e=(0,r.useContext)(s.PageTitleContext),i=(0,r.useContext)(s.PageActionsContext),{selectedTeam:o,selectTeamById:d,connectionStatus:x,connect:u,disconnect:m}=(0,a.useDeveloper)(),{user:g}=(0,n.useUser)(),h=(0,n.useMinRole)("engineer"),[b,f]=(0,r.useState)("browser"),[y,j]=(0,r.useState)([]),[v,N]=(0,r.useState)(null),[w,S]=(0,r.useState)(eh[0]),[k,T]=(0,r.useState)(!0),[_,E]=(0,r.useState)({});return((0,r.useEffect)(()=>{async function e(){try{let e=await fetch("/api/dev-session/status"),t=await e.json();t.success&&t.lockedTeams&&E(t.lockedTeams)}catch(e){console.error("Failed to fetch locked teams:",e)}}e();let t=setInterval(e,1e4);return()=>clearInterval(t)},[]),(0,r.useEffect)(()=>{!async function(){try{let e=await fetch("/api/projects"),t=await e.json();t.success&&t.projects&&(j(t.projects),t.projects.length>0&&N(t.projects[0]))}catch(e){console.error("Failed to fetch projects:",e)}finally{T(!1)}}()},[]),(0,r.useEffect)(()=>(e({title:"Studio",description:"Development environment with Claude AI"}),i((0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("select",{value:v?.id||"",onChange:e=>{N(y.find(t=>t.id===e.target.value)||null)},className:"w-44 bg-gray-800/80 text-white text-sm px-3 py-1.5 rounded-lg border border-gray-600 focus:outline-none focus:ring-2 focus:ring-white/30",disabled:k,children:k?(0,t.jsx)("option",{children:"Loading..."}):0===y.length?(0,t.jsx)("option",{children:"No projects"}):y.map(e=>(0,t.jsx)("option",{value:e.id,children:e.name},e.id))}),(0,t.jsx)("select",{value:w.id,onChange:e=>{let t=eh.find(t=>t.id===e.target.value);t&&S(t)},className:"w-44 bg-gray-800/80 text-white text-sm px-3 py-1.5 rounded-lg border border-gray-600 focus:outline-none focus:ring-2 focus:ring-white/30",children:eh.map(e=>(0,t.jsx)("option",{value:e.id,children:e.name},e.id))})]})),()=>{e({title:"",description:""}),i(null)}),[e,i,y,v,w,k]),h)?"connected"!==x?(0,t.jsx)("div",{className:"h-full flex items-center justify-center bg-gray-900",children:(0,t.jsx)("div",{className:"max-w-lg w-full mx-4",children:(0,t.jsxs)("div",{className:"bg-gray-800 rounded-2xl border border-gray-700 shadow-2xl overflow-hidden",children:[(0,t.jsxs)("div",{className:"p-6 text-center border-b border-gray-700",style:{background:"linear-gradient(to right, #3B82F6, #06B6D4)"},children:[(0,t.jsx)(ep,{className:"w-12 h-12 text-white mx-auto mb-3"}),(0,t.jsx)("h2",{className:"text-xl font-bold text-white",children:"Welcome to Studio"}),(0,t.jsx)("p",{className:"text-white/80 text-sm mt-1",children:"Select your dev team and connect to begin"})]}),(0,t.jsxs)("div",{className:"p-6 space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Select Development Team"}),(0,t.jsx)("div",{className:"space-y-2",children:a.DEVELOPER_TEAMS.map((e,r)=>{let s=_[e.id],a=s&&s.userId!==g?.id,n=s&&s.userId===g?.id;return(0,t.jsxs)("button",{onClick:()=>!a&&d(e.id),disabled:a,className:`w-full p-3 rounded-lg border text-left transition-all flex items-center justify-between ${a?"border-red-800/50 bg-red-900/20 cursor-not-allowed opacity-60":o.id===e.id?"border-cyan-500 bg-cyan-500/20":"border-gray-600 bg-gray-700/50 hover:border-gray-500"}`,children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:`w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold ${a?"bg-red-800/50 text-red-300":o.id===e.id?"bg-cyan-500 text-white":"bg-gray-600 text-gray-300"}`,children:a?(0,t.jsx)(l.Lock,{className:"w-4 h-4"}):r+1}),(0,t.jsxs)("div",{className:"flex flex-col",children:[(0,t.jsxs)("span",{className:`font-medium ${a?"text-red-400":o.id===e.id?"text-cyan-400":"text-gray-300"}`,children:["Development Team ",r+1]}),a&&(0,t.jsxs)("span",{className:"text-xs text-red-400/70",children:["Locked by ",s.userName]})]})]}),a?(0,t.jsx)("span",{className:"text-red-400 text-xs",children:"In Use"}):n?(0,t.jsx)("span",{className:"text-green-400 text-xs",children:"Your Session"}):o.id===e.id?(0,t.jsx)("span",{className:"text-cyan-400 text-sm",children:"Selected"}):(0,t.jsx)("span",{className:"text-green-400 text-xs",children:"Available"})]},e.id)})})]}),(0,t.jsx)("button",{onClick:()=>g?.id&&u(g.id),disabled:!g?.id||"connecting"===x,className:"w-full flex items-center justify-center gap-2 px-4 py-3 bg-gradient-to-r from-blue-500 to-cyan-500 text-white font-medium rounded-lg hover:from-blue-600 hover:to-cyan-600 transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:"connecting"===x?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(em,{className:"w-5 h-5 animate-pulse"}),(0,t.jsx)("span",{children:"Connecting..."})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(eg,{className:"w-5 h-5"}),(0,t.jsxs)("span",{children:["Connect to Development Team ",o.id.replace("dev","")]})]})}),(0,t.jsxs)("p",{className:"text-center text-gray-500 text-xs",children:["Your session will be logged for ",g?.name||"your account"]})]})]})})}):(0,t.jsxs)("div",{className:"h-full flex bg-gray-900",children:[(0,t.jsx)("div",{className:"w-14 bg-gray-800 border-r border-gray-700 flex flex-col items-center py-2 flex-shrink-0",children:(0,t.jsx)(c,{items:eb,activePanel:b,onPanelChange:f})}),(0,t.jsxs)("div",{className:"flex-1 flex overflow-hidden",children:[(0,t.jsx)("div",{className:"flex-1 flex flex-col border-r border-gray-700",children:"browser"===b?(0,t.jsx)(p,{project:v,env:w}):"hub"===b?(0,t.jsx)(O,{teamBasePort:o.basePort}):"projects"===b?(0,t.jsx)("div",{className:"flex-1 overflow-auto p-4",children:(0,t.jsx)(eu,{})}):(0,t.jsx)("div",{className:"flex-1 flex items-center justify-center text-gray-600 text-sm",children:b?`${b} panel - coming soon`:"Select a panel from the sidebar"})}),(0,t.jsxs)("div",{className:"w-[400px] bg-gray-850 flex flex-col flex-shrink-0",children:[(0,t.jsxs)("div",{className:"h-10 flex items-center justify-between px-3",style:{background:"linear-gradient(to right, #3B82F6, #06B6D4)"},children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{className:"text-sm font-medium text-white",children:"AI Team"}),(0,t.jsxs)("span",{className:"text-xs text-white/70",children:["(",o.portRange,")"]})]}),(0,t.jsxs)("button",{onClick:m,className:"flex items-center gap-2 px-3 py-1 bg-green-500/30 text-white border border-white/30 rounded-lg hover:bg-red-500/30 hover:border-red-400/50 transition-colors",children:[(0,t.jsx)(eg,{className:"w-4 h-4"}),(0,t.jsx)("span",{className:"text-sm font-medium",children:"Connected"}),(0,t.jsx)("span",{className:"w-2 h-2 rounded-full bg-green-400 animate-pulse"})]})]}),(0,t.jsx)("div",{className:"flex-1 min-h-0 flex flex-col",children:(0,t.jsx)(C,{port:o.basePort,projectPath:v?.server_path||"/var/www/Studio"})})]})]})]}):(0,t.jsx)("div",{className:"h-full flex items-center justify-center bg-gray-900",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)(l.Lock,{className:"w-16 h-16 text-gray-600 mx-auto mb-4"}),(0,t.jsx)("h2",{className:"text-xl font-bold text-white mb-2",children:"Access Restricted"}),(0,t.jsx)("p",{className:"text-gray-400",children:"Engineer+ access required for the Dev Studio Environment."})]})})}e.s(["default",()=>ef],62093)}]);